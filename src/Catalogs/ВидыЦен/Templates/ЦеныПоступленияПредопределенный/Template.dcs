<?xml version="1.0" encoding="UTF-8"?>
<DataCompositionSchema xmlns="http://v8.1c.ru/8.1/data-composition-system/schema" xmlns:dcscom="http://v8.1c.ru/8.1/data-composition-system/common" xmlns:dcscor="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:dcsset="http://v8.1c.ru/8.1/data-composition-system/settings" xmlns:v8="http://v8.1c.ru/8.1/data/core" xmlns:v8ui="http://v8.1c.ru/8.1/data/ui" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<dataSource>
		<name>ИсточникДанных1</name>
		<dataSourceType>Local</dataSourceType>
	</dataSource>
	<dataSet xsi:type="DataSetQuery">
		<name>НаборДанных1</name>
		<field xsi:type="DataSetFieldField">
			<dataPath>Номенклатура</dataPath>
			<field>Номенклатура</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Коэффициент</dataPath>
			<field>Коэффициент</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Коэффициент</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Характеристика</dataPath>
			<field>Характеристика</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЕдиницаИзмерения</dataPath>
			<field>ЕдиницаИзмерения</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Цена</dataPath>
			<field>Цена</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Цена</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Период</dataPath>
			<field>Период</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Период</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Валюта</dataPath>
			<field>Валюта</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Валюта</v8:content>
				</v8:item>
			</title>
		</field>
		<dataSource>ИсточникДанных1</dataSource>
		<query>ВЫБРАТЬ
	ПриходнаяНакладнаяТовары.Номенклатура КАК Номенклатура,
	ПриходнаяНакладнаяТовары.Характеристика КАК Характеристика,
	МАКСИМУМ(ПриходнаяНакладнаяТовары.Ссылка.Дата) КАК МаксимальнаяДата
ПОМЕСТИТЬ ДатыПоступлений
ИЗ
	Документ.ПриходнаяНакладная.Запасы КАК ПриходнаяНакладнаяТовары
ГДЕ
	ПриходнаяНакладнаяТовары.Ссылка.Дата &lt;= &amp;ДатаДокумента
	И ПриходнаяНакладнаяТовары.Ссылка.Проведен
	И НЕ &amp;ЭтоВводНаОсновании
{ГДЕ
	ПриходнаяНакладнаяТовары.Номенклатура КАК Номенклатура,
	ПриходнаяНакладнаяТовары.Характеристика КАК Характеристика}

СГРУППИРОВАТЬ ПО
	ПриходнаяНакладнаяТовары.Характеристика,
	ПриходнаяНакладнаяТовары.Номенклатура

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ПриходнаяНакладнаяТовары.Номенклатура,
	ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка),
	МАКСИМУМ(ПриходнаяНакладнаяТовары.Ссылка.Дата)
ИЗ
	Документ.ПриходнаяНакладная.Расходы КАК ПриходнаяНакладнаяТовары
ГДЕ
	ПриходнаяНакладнаяТовары.Ссылка.Дата &lt;= &amp;ДатаДокумента
	И ПриходнаяНакладнаяТовары.Ссылка.Проведен
	И НЕ &amp;ЭтоВводНаОсновании
{ГДЕ
	ПриходнаяНакладнаяТовары.Номенклатура КАК Номенклатура,
	(ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка)) КАК Характеристика}

СГРУППИРОВАТЬ ПО
	ПриходнаяНакладнаяТовары.Номенклатура
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПриходнаяНакладнаяТовары.Номенклатура КАК Номенклатура,
	ПриходнаяНакладнаяТовары.Характеристика КАК Характеристика,
	МАКСИМУМ(ПриходнаяНакладнаяТовары.Ссылка) КАК ДокументПоступления,
	МАКСИМУМ(Таблица.МаксимальнаяДата) КАК Дата
ПОМЕСТИТЬ ПоследниеПоступления
ИЗ
	Документ.ПриходнаяНакладная.Запасы КАК ПриходнаяНакладнаяТовары
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДатыПоступлений КАК Таблица
		ПО ПриходнаяНакладнаяТовары.Номенклатура = Таблица.Номенклатура
			И ПриходнаяНакладнаяТовары.Характеристика = Таблица.Характеристика
			И ПриходнаяНакладнаяТовары.Ссылка.Дата = Таблица.МаксимальнаяДата
ГДЕ
	НЕ &amp;ЭтоВводНаОсновании

СГРУППИРОВАТЬ ПО
	ПриходнаяНакладнаяТовары.Характеристика,
	ПриходнаяНакладнаяТовары.Номенклатура

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ПриходнаяНакладнаяТовары.Номенклатура,
	ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка),
	МАКСИМУМ(ПриходнаяНакладнаяТовары.Ссылка),
	МАКСИМУМ(Таблица.МаксимальнаяДата)
ИЗ
	Документ.ПриходнаяНакладная.Расходы КАК ПриходнаяНакладнаяТовары
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДатыПоступлений КАК Таблица
		ПО ПриходнаяНакладнаяТовары.Номенклатура = Таблица.Номенклатура
			И ПриходнаяНакладнаяТовары.Ссылка.Дата = Таблица.МаксимальнаяДата
ГДЕ
	НЕ &amp;ЭтоВводНаОсновании

СГРУППИРОВАТЬ ПО
	ПриходнаяНакладнаяТовары.Номенклатура
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ОприходованиеЗапасов.Номенклатура КАК Номенклатура,
	ОприходованиеЗапасов.Характеристика КАК Характеристика,
	МАКСИМУМ(ОприходованиеЗапасов.Ссылка.Дата) КАК МаксимальнаяДата
ПОМЕСТИТЬ ДатыОприходований
ИЗ
	Документ.ОприходованиеЗапасов.Запасы КАК ОприходованиеЗапасов
ГДЕ
	ОприходованиеЗапасов.Ссылка.Дата &lt;= &amp;ДатаДокумента
	И ОприходованиеЗапасов.Ссылка.Проведен
	И НЕ &amp;ЭтоВводНаОсновании
{ГДЕ
	ОприходованиеЗапасов.Номенклатура КАК Номенклатура,
	ОприходованиеЗапасов.Характеристика КАК Характеристика}

СГРУППИРОВАТЬ ПО
	ОприходованиеЗапасов.Характеристика,
	ОприходованиеЗапасов.Номенклатура
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ОприходованиеЗапасов.Номенклатура КАК Номенклатура,
	ОприходованиеЗапасов.Характеристика КАК Характеристика,
	МАКСИМУМ(ОприходованиеЗапасов.Ссылка) КАК ДокументПоступления,
	МАКСИМУМ(Таблица.МаксимальнаяДата) КАК Дата
ПОМЕСТИТЬ ПоследниеОприходования
ИЗ
	Документ.ОприходованиеЗапасов.Запасы КАК ОприходованиеЗапасов
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДатыОприходований КАК Таблица
		ПО ОприходованиеЗапасов.Номенклатура = Таблица.Номенклатура
			И ОприходованиеЗапасов.Характеристика = Таблица.Характеристика
			И ОприходованиеЗапасов.Ссылка.Дата = Таблица.МаксимальнаяДата
ГДЕ
	НЕ &amp;ЭтоВводНаОсновании

СГРУППИРОВАТЬ ПО
	ОприходованиеЗапасов.Характеристика,
	ОприходованиеЗапасов.Номенклатура
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	АвансовыйОтчетЗапасов.Номенклатура КАК Номенклатура,
	АвансовыйОтчетЗапасов.Характеристика КАК Характеристика,
	МАКСИМУМ(АвансовыйОтчетЗапасов.Ссылка.Дата) КАК МаксимальнаяДата
ПОМЕСТИТЬ ДатыАвансовых
ИЗ
	Документ.АвансовыйОтчет.Запасы КАК АвансовыйОтчетЗапасов
ГДЕ
	АвансовыйОтчетЗапасов.Ссылка.Дата &lt;= &amp;ДатаДокумента
	И АвансовыйОтчетЗапасов.Ссылка.Проведен
	И НЕ &amp;ЭтоВводНаОсновании
{ГДЕ
	АвансовыйОтчетЗапасов.Номенклатура КАК Номенклатура,
	АвансовыйОтчетЗапасов.Характеристика КАК Характеристика}

СГРУППИРОВАТЬ ПО
	АвансовыйОтчетЗапасов.Характеристика,
	АвансовыйОтчетЗапасов.Номенклатура

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	АвансовыйОтчетЗапасов.Номенклатура,
	ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка),
	МАКСИМУМ(АвансовыйОтчетЗапасов.Ссылка.Дата)
ИЗ
	Документ.АвансовыйОтчет.Расходы КАК АвансовыйОтчетЗапасов
ГДЕ
	АвансовыйОтчетЗапасов.Ссылка.Дата &lt;= &amp;ДатаДокумента
	И АвансовыйОтчетЗапасов.Ссылка.Проведен
	И НЕ &amp;ЭтоВводНаОсновании
{ГДЕ
	АвансовыйОтчетЗапасов.Номенклатура КАК Номенклатура,
	(ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка)) КАК Характеристика}

СГРУППИРОВАТЬ ПО
	АвансовыйОтчетЗапасов.Номенклатура
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	АвансовыйОтчетЗапасов.Номенклатура КАК Номенклатура,
	АвансовыйОтчетЗапасов.Характеристика КАК Характеристика,
	МАКСИМУМ(АвансовыйОтчетЗапасов.Ссылка) КАК ДокументПоступления,
	МАКСИМУМ(Таблица.МаксимальнаяДата) КАК Дата
ПОМЕСТИТЬ ПоследниеАвансовые
ИЗ
	Документ.АвансовыйОтчет.Запасы КАК АвансовыйОтчетЗапасов
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДатыАвансовых КАК Таблица
		ПО АвансовыйОтчетЗапасов.Номенклатура = Таблица.Номенклатура
			И АвансовыйОтчетЗапасов.Характеристика = Таблица.Характеристика
			И АвансовыйОтчетЗапасов.Ссылка.Дата = Таблица.МаксимальнаяДата
ГДЕ
	НЕ &amp;ЭтоВводНаОсновании

СГРУППИРОВАТЬ ПО
	АвансовыйОтчетЗапасов.Характеристика,
	АвансовыйОтчетЗапасов.Номенклатура

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	АвансовыйОтчетЗапасов.Номенклатура,
	ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка),
	МАКСИМУМ(АвансовыйОтчетЗапасов.Ссылка),
	МАКСИМУМ(Таблица.МаксимальнаяДата)
ИЗ
	Документ.АвансовыйОтчет.Расходы КАК АвансовыйОтчетЗапасов
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДатыАвансовых КАК Таблица
		ПО АвансовыйОтчетЗапасов.Номенклатура = Таблица.Номенклатура
			И АвансовыйОтчетЗапасов.Ссылка.Дата = Таблица.МаксимальнаяДата
ГДЕ
	НЕ &amp;ЭтоВводНаОсновании

СГРУППИРОВАТЬ ПО
	АвансовыйОтчетЗапасов.Номенклатура
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПоследниеПоступления.Номенклатура КАК Номенклатура,
	ПоследниеПоступления.Характеристика КАК Характеристика,
	ПоследниеПоступления.ДокументПоступления КАК ДокументПоступления,
	ПоследниеПоступления.Дата КАК Дата
ПОМЕСТИТЬ ПоследниеДокументыПромежуточный
ИЗ
	ПоследниеПоступления КАК ПоследниеПоступления

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ПоследниеОприходования.Номенклатура,
	ПоследниеОприходования.Характеристика,
	ПоследниеОприходования.ДокументПоступления,
	ПоследниеОприходования.Дата
ИЗ
	ПоследниеОприходования КАК ПоследниеОприходования

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ПоследниеАвансовые.Номенклатура,
	ПоследниеАвансовые.Характеристика,
	ПоследниеАвансовые.ДокументПоступления,
	ПоследниеАвансовые.Дата
ИЗ
	ПоследниеАвансовые КАК ПоследниеАвансовые
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПоследниеДокументы.Номенклатура КАК Номенклатура,
	ПоследниеДокументы.Характеристика КАК Характеристика,
	МАКСИМУМ(ПоследниеДокументы.Дата) КАК МаксимальнаяДата
ПОМЕСТИТЬ ДатыДокументов
ИЗ
	ПоследниеДокументыПромежуточный КАК ПоследниеДокументы

СГРУППИРОВАТЬ ПО
	ПоследниеДокументы.Характеристика,
	ПоследниеДокументы.Номенклатура
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПоследниеДокументы.Номенклатура КАК Номенклатура,
	ПоследниеДокументы.Характеристика КАК Характеристика,
	МАКСИМУМ(ПоследниеДокументы.ДокументПоступления) КАК ДокументПоступления,
	МАКСИМУМ(Таблица.МаксимальнаяДата) КАК Дата
ПОМЕСТИТЬ ПоследниеДокументы
ИЗ
	ПоследниеДокументыПромежуточный КАК ПоследниеДокументы
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДатыДокументов КАК Таблица
		ПО ПоследниеДокументы.Номенклатура = Таблица.Номенклатура
			И ПоследниеДокументы.Характеристика = Таблица.Характеристика
			И ПоследниеДокументы.Дата = Таблица.МаксимальнаяДата

СГРУППИРОВАТЬ ПО
	ПоследниеДокументы.Характеристика,
	ПоследниеДокументы.Номенклатура
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТоварыДокумента.Ссылка.Дата КАК Период,
	ТоварыДокумента.Ссылка.ВалютаДокумента КАК Валюта,
	ТоварыДокумента.Номенклатура КАК Номенклатура,
	ТоварыДокумента.Характеристика КАК Характеристика,
	ТоварыДокумента.ЕдиницаИзмерения КАК ЕдиницаИзмерения,
	ТоварыДокумента.Количество КАК Количество,
	ЕСТЬNULL(ТоварыДокумента.ЕдиницаИзмерения.Коэффициент, 1) КАК Коэффициент,
	ВЫРАЗИТЬ(ВЫБОР
			КОГДА ВидыЦен.ЦенаВключаетНДС
						И ТоварыДокумента.Ссылка.СуммаВключаетНДС
					ИЛИ НЕ ВидыЦен.ЦенаВключаетНДС
						И НЕ ТоварыДокумента.Ссылка.СуммаВключаетНДС
				ТОГДА ТоварыДокумента.Цена
			КОГДА ВидыЦен.ЦенаВключаетНДС
					И НЕ ТоварыДокумента.Ссылка.СуммаВключаетНДС
				ТОГДА (ТоварыДокумента.Сумма + ТоварыДокумента.СуммаНДС) / ТоварыДокумента.Количество
			КОГДА НЕ ВидыЦен.ЦенаВключаетНДС
					И ТоварыДокумента.Ссылка.СуммаВключаетНДС
				ТОГДА (ТоварыДокумента.Сумма - ТоварыДокумента.СуммаНДС) / ТоварыДокумента.Количество
		КОНЕЦ КАК ЧИСЛО(15, 2)) КАК Цена
ПОМЕСТИТЬ ТаблицаЦены
ИЗ
	Документ.ПриходнаяНакладная.Запасы КАК ТоварыДокумента
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПоследниеДокументы КАК Таблица
		ПО ТоварыДокумента.Номенклатура = Таблица.Номенклатура
			И ТоварыДокумента.Характеристика = Таблица.Характеристика
			И ТоварыДокумента.Ссылка = Таблица.ДокументПоступления
		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыЦен КАК ВидыЦен
		ПО (ВидыЦен.Ссылка = &amp;ВидЦены)
ГДЕ
	НЕ &amp;ЭтоВводНаОсновании
	И ТоварыДокумента.Количество &lt;&gt; 0

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ТоварыДокумента.Ссылка.Дата,
	ТоварыДокумента.Ссылка.ВалютаДокумента,
	ТоварыДокумента.Номенклатура,
	ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка),
	ТоварыДокумента.ЕдиницаИзмерения,
	ТоварыДокумента.Количество,
	ЕСТЬNULL(ТоварыДокумента.ЕдиницаИзмерения.Коэффициент, 1),
	ВЫРАЗИТЬ(ВЫБОР
			КОГДА ВидыЦен.ЦенаВключаетНДС
						И ТоварыДокумента.Ссылка.СуммаВключаетНДС
					ИЛИ НЕ ВидыЦен.ЦенаВключаетНДС
						И НЕ ТоварыДокумента.Ссылка.СуммаВключаетНДС
				ТОГДА ТоварыДокумента.Цена
			КОГДА ВидыЦен.ЦенаВключаетНДС
					И НЕ ТоварыДокумента.Ссылка.СуммаВключаетНДС
				ТОГДА (ТоварыДокумента.Сумма + ТоварыДокумента.СуммаНДС) / ТоварыДокумента.Количество
			КОГДА НЕ ВидыЦен.ЦенаВключаетНДС
					И ТоварыДокумента.Ссылка.СуммаВключаетНДС
				ТОГДА (ТоварыДокумента.Сумма - ТоварыДокумента.СуммаНДС) / ТоварыДокумента.Количество
		КОНЕЦ КАК ЧИСЛО(15, 2))
ИЗ
	Документ.ПриходнаяНакладная.Расходы КАК ТоварыДокумента
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПоследниеДокументы КАК Таблица
		ПО ТоварыДокумента.Номенклатура = Таблица.Номенклатура
			И ТоварыДокумента.Ссылка = Таблица.ДокументПоступления
		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыЦен КАК ВидыЦен
		ПО (ВидыЦен.Ссылка = &amp;ВидЦены)
ГДЕ
	НЕ &amp;ЭтоВводНаОсновании
	И ТоварыДокумента.Количество &lt;&gt; 0

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ТоварыДокумента.Ссылка.Дата,
	&amp;ВалютаУчета,
	ТоварыДокумента.Номенклатура,
	ТоварыДокумента.Характеристика,
	ТоварыДокумента.ЕдиницаИзмерения,
	ТоварыДокумента.Количество,
	ЕСТЬNULL(ТоварыДокумента.ЕдиницаИзмерения.Коэффициент, 1),
	ТоварыДокумента.Цена
ИЗ
	Документ.ОприходованиеЗапасов.Запасы КАК ТоварыДокумента
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПоследниеДокументы КАК Таблица
		ПО ТоварыДокумента.Номенклатура = Таблица.Номенклатура
			И ТоварыДокумента.Характеристика = Таблица.Характеристика
			И ТоварыДокумента.Ссылка = Таблица.ДокументПоступления
ГДЕ
	НЕ &amp;ЭтоВводНаОсновании
	И ТоварыДокумента.Количество &lt;&gt; 0

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ТоварыДокумента.Ссылка.Дата,
	&amp;ВалютаУчета,
	ТоварыДокумента.Номенклатура,
	ТоварыДокумента.Характеристика,
	ТоварыДокумента.ЕдиницаИзмерения,
	ТоварыДокумента.Количество,
	ЕСТЬNULL(ТоварыДокумента.ЕдиницаИзмерения.Коэффициент, 1),
	ТоварыДокумента.Цена
ИЗ
	Документ.АвансовыйОтчет.Запасы КАК ТоварыДокумента
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПоследниеДокументы КАК Таблица
		ПО ТоварыДокумента.Номенклатура = Таблица.Номенклатура
			И ТоварыДокумента.Характеристика = Таблица.Характеристика
			И ТоварыДокумента.Ссылка = Таблица.ДокументПоступления
ГДЕ
	НЕ &amp;ЭтоВводНаОсновании
	И ТоварыДокумента.Количество &lt;&gt; 0

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ТоварыДокумента.Ссылка.Дата,
	&amp;ВалютаУчета,
	ТоварыДокумента.Номенклатура,
	ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка),
	ТоварыДокумента.ЕдиницаИзмерения,
	ТоварыДокумента.Количество,
	ЕСТЬNULL(ТоварыДокумента.ЕдиницаИзмерения.Коэффициент, 1),
	ТоварыДокумента.Цена
ИЗ
	Документ.АвансовыйОтчет.Расходы КАК ТоварыДокумента
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПоследниеДокументы КАК Таблица
		ПО ТоварыДокумента.Номенклатура = Таблица.Номенклатура
			И ТоварыДокумента.Ссылка = Таблица.ДокументПоступления
ГДЕ
	НЕ &amp;ЭтоВводНаОсновании
	И ТоварыДокумента.Количество &lt;&gt; 0

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ТоварыДокументаВводНаОсновании.Ссылка.Дата,
	ТоварыДокументаВводНаОсновании.Ссылка.ВалютаДокумента,
	ТоварыДокументаВводНаОсновании.Номенклатура,
	ТоварыДокументаВводНаОсновании.Характеристика,
	ТоварыДокументаВводНаОсновании.ЕдиницаИзмерения,
	ТоварыДокументаВводНаОсновании.Количество,
	ЕСТЬNULL(ТоварыДокументаВводНаОсновании.ЕдиницаИзмерения.Коэффициент, 1),
	ВЫРАЗИТЬ(ВЫБОР
			КОГДА ВидыЦен.ЦенаВключаетНДС
						И ТоварыДокументаВводНаОсновании.Ссылка.СуммаВключаетНДС
					ИЛИ НЕ ВидыЦен.ЦенаВключаетНДС
						И НЕ ТоварыДокументаВводНаОсновании.Ссылка.СуммаВключаетНДС
				ТОГДА ТоварыДокументаВводНаОсновании.Цена
			КОГДА ВидыЦен.ЦенаВключаетНДС
					И НЕ ТоварыДокументаВводНаОсновании.Ссылка.СуммаВключаетНДС
				ТОГДА (ТоварыДокументаВводНаОсновании.Сумма + ТоварыДокументаВводНаОсновании.СуммаНДС) / ТоварыДокументаВводНаОсновании.Количество
			КОГДА НЕ ВидыЦен.ЦенаВключаетНДС
					И ТоварыДокументаВводНаОсновании.Ссылка.СуммаВключаетНДС
				ТОГДА (ТоварыДокументаВводНаОсновании.Сумма - ТоварыДокументаВводНаОсновании.СуммаНДС) / ТоварыДокументаВводНаОсновании.Количество
		КОНЕЦ КАК ЧИСЛО(15, 2))
ИЗ
	Документ.ПриходнаяНакладная.Запасы КАК ТоварыДокументаВводНаОсновании
		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыЦен КАК ВидыЦен
		ПО (ВидыЦен.Ссылка = &amp;ВидЦены)
ГДЕ
	ТоварыДокументаВводНаОсновании.Ссылка = &amp;Основание
	И ТоварыДокументаВводНаОсновании.Количество &lt;&gt; 0
	И &amp;ЭтоВводНаОсновании

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ТоварыДокументаВводНаОсновании.Ссылка.Дата,
	ТоварыДокументаВводНаОсновании.Ссылка.ВалютаДокумента,
	ТоварыДокументаВводНаОсновании.Номенклатура,
	ЗНАЧЕНИЕ(СПравочник.ХарактеристикиНоменклатуры.ПустаяСсылка),
	ТоварыДокументаВводНаОсновании.ЕдиницаИзмерения,
	ТоварыДокументаВводНаОсновании.Количество,
	ЕСТЬNULL(ТоварыДокументаВводНаОсновании.ЕдиницаИзмерения.Коэффициент, 1),
	ВЫРАЗИТЬ(ВЫБОР
			КОГДА ВидыЦен.ЦенаВключаетНДС
						И ТоварыДокументаВводНаОсновании.Ссылка.СуммаВключаетНДС
					ИЛИ НЕ ВидыЦен.ЦенаВключаетНДС
						И НЕ ТоварыДокументаВводНаОсновании.Ссылка.СуммаВключаетНДС
				ТОГДА ТоварыДокументаВводНаОсновании.Цена
			КОГДА ВидыЦен.ЦенаВключаетНДС
					И НЕ ТоварыДокументаВводНаОсновании.Ссылка.СуммаВключаетНДС
				ТОГДА (ТоварыДокументаВводНаОсновании.Сумма + ТоварыДокументаВводНаОсновании.СуммаНДС) / ТоварыДокументаВводНаОсновании.Количество
			КОГДА НЕ ВидыЦен.ЦенаВключаетНДС
					И ТоварыДокументаВводНаОсновании.Ссылка.СуммаВключаетНДС
				ТОГДА (ТоварыДокументаВводНаОсновании.Сумма - ТоварыДокументаВводНаОсновании.СуммаНДС) / ТоварыДокументаВводНаОсновании.Количество
		КОНЕЦ КАК ЧИСЛО(15, 2))
ИЗ
	Документ.ПриходнаяНакладная.Расходы КАК ТоварыДокументаВводНаОсновании
		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыЦен КАК ВидыЦен
		ПО (ВидыЦен.Ссылка = &amp;ВидЦены)
ГДЕ
	ТоварыДокументаВводНаОсновании.Ссылка = &amp;Основание
	И ТоварыДокументаВводНаОсновании.Количество &lt;&gt; 0
	И &amp;ЭтоВводНаОсновании

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ТоварыДокументаВводНаОсновании.Ссылка.Дата,
	&amp;ВалютаУчета,
	ТоварыДокументаВводНаОсновании.Номенклатура,
	ТоварыДокументаВводНаОсновании.Характеристика,
	ТоварыДокументаВводНаОсновании.ЕдиницаИзмерения,
	ТоварыДокументаВводНаОсновании.Количество,
	ЕСТЬNULL(ТоварыДокументаВводНаОсновании.ЕдиницаИзмерения.Коэффициент, 1),
	ТоварыДокументаВводНаОсновании.Цена
ИЗ
	Документ.ОприходованиеЗапасов.Запасы КАК ТоварыДокументаВводНаОсновании
		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыЦен КАК ВидыЦен
		ПО (ВидыЦен.Ссылка = &amp;ВидЦены)
ГДЕ
	ТоварыДокументаВводНаОсновании.Ссылка = &amp;Основание
	И ТоварыДокументаВводНаОсновании.Количество &lt;&gt; 0
	И &amp;ЭтоВводНаОсновании

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ТоварыДокументаВводНаОсновании.Ссылка.Дата,
	ТоварыДокументаВводНаОсновании.Ссылка.ВалютаДокумента,
	ТоварыДокументаВводНаОсновании.Номенклатура,
	ТоварыДокументаВводНаОсновании.Характеристика,
	ТоварыДокументаВводНаОсновании.ЕдиницаИзмерения,
	ТоварыДокументаВводНаОсновании.Количество,
	ЕСТЬNULL(ТоварыДокументаВводНаОсновании.ЕдиницаИзмерения.Коэффициент, 1),
	ВЫРАЗИТЬ(ВЫБОР
			КОГДА ВидыЦен.ЦенаВключаетНДС
						И ТоварыДокументаВводНаОсновании.Ссылка.СуммаВключаетНДС
					ИЛИ НЕ ВидыЦен.ЦенаВключаетНДС
						И НЕ ТоварыДокументаВводНаОсновании.Ссылка.СуммаВключаетНДС
				ТОГДА ТоварыДокументаВводНаОсновании.Цена
			КОГДА ВидыЦен.ЦенаВключаетНДС
					И НЕ ТоварыДокументаВводНаОсновании.Ссылка.СуммаВключаетНДС
				ТОГДА (ТоварыДокументаВводНаОсновании.Сумма + ТоварыДокументаВводНаОсновании.СуммаНДС) / ТоварыДокументаВводНаОсновании.Количество
			КОГДА НЕ ВидыЦен.ЦенаВключаетНДС
					И ТоварыДокументаВводНаОсновании.Ссылка.СуммаВключаетНДС
				ТОГДА (ТоварыДокументаВводНаОсновании.Сумма - ТоварыДокументаВводНаОсновании.СуммаНДС) / ТоварыДокументаВводНаОсновании.Количество
		КОНЕЦ КАК ЧИСЛО(15, 2))
ИЗ
	Документ.АвансовыйОтчет.Запасы КАК ТоварыДокументаВводНаОсновании
		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыЦен КАК ВидыЦен
		ПО (ВидыЦен.Ссылка = &amp;ВидЦены)
ГДЕ
	ТоварыДокументаВводНаОсновании.Ссылка = &amp;Основание
	И ТоварыДокументаВводНаОсновании.Количество &lt;&gt; 0
	И &amp;ЭтоВводНаОсновании

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ТоварыДокументаВводНаОсновании.Ссылка.Дата,
	ТоварыДокументаВводНаОсновании.Ссылка.ВалютаДокумента,
	ТоварыДокументаВводНаОсновании.Номенклатура,
	ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка),
	ТоварыДокументаВводНаОсновании.ЕдиницаИзмерения,
	ТоварыДокументаВводНаОсновании.Количество,
	ЕСТЬNULL(ТоварыДокументаВводНаОсновании.ЕдиницаИзмерения.Коэффициент, 1),
	ВЫРАЗИТЬ(ВЫБОР
			КОГДА ВидыЦен.ЦенаВключаетНДС
						И ТоварыДокументаВводНаОсновании.Ссылка.СуммаВключаетНДС
					ИЛИ НЕ ВидыЦен.ЦенаВключаетНДС
						И НЕ ТоварыДокументаВводНаОсновании.Ссылка.СуммаВключаетНДС
				ТОГДА ТоварыДокументаВводНаОсновании.Цена
			КОГДА ВидыЦен.ЦенаВключаетНДС
					И НЕ ТоварыДокументаВводНаОсновании.Ссылка.СуммаВключаетНДС
				ТОГДА (ТоварыДокументаВводНаОсновании.Сумма + ТоварыДокументаВводНаОсновании.СуммаНДС) / ТоварыДокументаВводНаОсновании.Количество
			КОГДА НЕ ВидыЦен.ЦенаВключаетНДС
					И ТоварыДокументаВводНаОсновании.Ссылка.СуммаВключаетНДС
				ТОГДА (ТоварыДокументаВводНаОсновании.Сумма - ТоварыДокументаВводНаОсновании.СуммаНДС) / ТоварыДокументаВводНаОсновании.Количество
		КОНЕЦ КАК ЧИСЛО(15, 2))
ИЗ
	Документ.АвансовыйОтчет.Расходы КАК ТоварыДокументаВводНаОсновании
		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыЦен КАК ВидыЦен
		ПО (ВидыЦен.Ссылка = &amp;ВидЦены)
ГДЕ
	ТоварыДокументаВводНаОсновании.Ссылка = &amp;Основание
	И ТоварыДокументаВводНаОсновании.Количество &lt;&gt; 0
	И &amp;ЭтоВводНаОсновании
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаЦены.Номенклатура КАК Номенклатура,
	ТаблицаЦены.Характеристика КАК Характеристика,
	МАКСИМУМ(ВЫРАЗИТЬ(ТаблицаЦены.Цена / ТаблицаЦены.Коэффициент КАК ЧИСЛО(15, 2))) КАК МаксимальнаяЦенаЗаЕдиницу,
	МИНИМУМ(ВЫРАЗИТЬ(ТаблицаЦены.Цена / ТаблицаЦены.Коэффициент КАК ЧИСЛО(15, 2))) КАК МинимальнаяЦенаЗаЕдиницу,
	СУММА(ТаблицаЦены.Цена * ТаблицаЦены.Количество) / СУММА(ТаблицаЦены.Количество * ТаблицаЦены.Коэффициент) КАК СредняяЦенаЗаЕдиницу
ПОМЕСТИТЬ Цены
ИЗ
	ТаблицаЦены КАК ТаблицаЦены

СГРУППИРОВАТЬ ПО
	ТаблицаЦены.Номенклатура,
	ТаблицаЦены.Характеристика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаЦены.Номенклатура КАК Номенклатура,
	ТаблицаЦены.Характеристика КАК Характеристика,
	МАКСИМУМ(ТаблицаЦены.Коэффициент) КАК МаксимальныйКоэффициент,
	МИНИМУМ(ТаблицаЦены.Коэффициент) КАК МинимальныйКоэффициент
ПОМЕСТИТЬ Коэффициенты
ИЗ
	ТаблицаЦены КАК ТаблицаЦены

СГРУППИРОВАТЬ ПО
	ТаблицаЦены.Номенклатура,
	ТаблицаЦены.Характеристика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	ТаблицаЦены.Период КАК Период,
	ТаблицаЦены.Валюта КАК Валюта,
	ТаблицаЦены.Номенклатура КАК Номенклатура,
	ТаблицаЦены.Характеристика КАК Характеристика,
	ТаблицаЦены.ЕдиницаИзмерения КАК ЕдиницаИзмерения,
	ТаблицаЦены.Коэффициент КАК Коэффициент,
	ВЫБОР
		КОГДА &amp;ВыборЦены = "Максимальная цена"
			ТОГДА ВЫРАЗИТЬ(Цены.МаксимальнаяЦенаЗаЕдиницу * ТаблицаЦены.Коэффициент КАК ЧИСЛО(15, 2))
		КОГДА &amp;ВыборЦены = "Минимальная цена"
			ТОГДА ВЫРАЗИТЬ(Цены.МинимальнаяЦенаЗаЕдиницу * ТаблицаЦены.Коэффициент КАК ЧИСЛО(15, 2))
		КОГДА &amp;ВыборЦены = "Средняя цена"
			ТОГДА ВЫРАЗИТЬ(Цены.СредняяЦенаЗаЕдиницу * ТаблицаЦены.Коэффициент КАК ЧИСЛО(15, 2))
		ИНАЧЕ 0
	КОНЕЦ КАК Цена
ИЗ
	ТаблицаЦены КАК ТаблицаЦены
		ЛЕВОЕ СОЕДИНЕНИЕ Цены КАК Цены
		ПО (Цены.Номенклатура = ТаблицаЦены.Номенклатура)
			И (Цены.Характеристика = ТаблицаЦены.Характеристика)
		ЛЕВОЕ СОЕДИНЕНИЕ Коэффициенты КАК Коэффициенты
		ПО (Коэффициенты.Номенклатура = ТаблицаЦены.Номенклатура)
			И (Коэффициенты.Характеристика = ТаблицаЦены.Характеристика)
ГДЕ
	ВЫБОР
			КОГДА &amp;ВыборЕдиницы = "Максимальный коэффициент"
				ТОГДА ТаблицаЦены.Коэффициент = Коэффициенты.МаксимальныйКоэффициент
			КОГДА &amp;ВыборЕдиницы = "Минимальный коэффициент"
				ТОГДА ТаблицаЦены.Коэффициент = Коэффициенты.МинимальныйКоэффициент
			ИНАЧЕ ЛОЖЬ
		КОНЕЦ</query>
	</dataSet>
	<parameter>
		<name>Основание</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Основание</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type xmlns:d4p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d4p1:DocumentRef.ПриходнаяНакладная</v8:Type>
			<v8:Type xmlns:d4p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d4p1:DocumentRef.АвансовыйОтчет</v8:Type>
			<v8:Type xmlns:d4p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d4p1:DocumentRef.ОприходованиеЗапасов</v8:Type>
		</valueType>
		<value xsi:nil="true"/>
		<useRestriction>true</useRestriction>
		<availableAsField>false</availableAsField>
	</parameter>
	<parameter>
		<name>ДатаДокумента</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Дата документа</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>true</useRestriction>
		<availableAsField>false</availableAsField>
	</parameter>
	<parameter>
		<name>ВидЦены</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Вид цены</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type xmlns:d4p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d4p1:CatalogRef.ВидыЦен</v8:Type>
		</valueType>
		<value xsi:nil="true"/>
		<useRestriction>true</useRestriction>
		<availableAsField>false</availableAsField>
	</parameter>
	<parameter>
		<name>ЭтоВводНаОсновании</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Это ввод на основании</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:boolean</v8:Type>
		</valueType>
		<value xsi:type="xs:boolean">false</value>
		<useRestriction>true</useRestriction>
		<availableAsField>false</availableAsField>
	</parameter>
	<parameter>
		<name>ВалютаУчета</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Валюта учета</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type xmlns:d4p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d4p1:CatalogRef.Валюты</v8:Type>
		</valueType>
		<value xsi:nil="true"/>
		<useRestriction>true</useRestriction>
		<availableAsField>false</availableAsField>
	</parameter>
	<parameter>
		<name>ВыборЦены</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Выбор цены</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:string</v8:Type>
			<v8:StringQualifiers>
				<v8:Length>0</v8:Length>
				<v8:AllowedLength>Variable</v8:AllowedLength>
			</v8:StringQualifiers>
		</valueType>
		<value xsi:type="xs:string"/>
		<useRestriction>false</useRestriction>
		<availableValue>
			<value xsi:type="xs:string">Максимальная цена</value>
			<presentation xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Максимальная цена</v8:content>
				</v8:item>
			</presentation>
		</availableValue>
		<availableValue>
			<value xsi:type="xs:string">Минимальная цена</value>
			<presentation xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Минимальная цена</v8:content>
				</v8:item>
			</presentation>
		</availableValue>
		<availableValue>
			<value xsi:type="xs:string">Средняя цена</value>
			<presentation xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Средняя цена</v8:content>
				</v8:item>
			</presentation>
		</availableValue>
		<availableAsField>false</availableAsField>
	</parameter>
	<parameter>
		<name>ВыборЕдиницы</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Выбор единицы</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:string</v8:Type>
			<v8:StringQualifiers>
				<v8:Length>0</v8:Length>
				<v8:AllowedLength>Variable</v8:AllowedLength>
			</v8:StringQualifiers>
		</valueType>
		<value xsi:type="xs:string">Максимальный коэффициент</value>
		<useRestriction>false</useRestriction>
		<availableValue>
			<value xsi:type="xs:string">Максимальный коэффициент</value>
			<presentation xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Максимальный коэффициент</v8:content>
				</v8:item>
			</presentation>
		</availableValue>
		<availableValue>
			<value xsi:type="xs:string">Минимальный коэффициент</value>
			<presentation xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Минимальный коэффициент</v8:content>
				</v8:item>
			</presentation>
		</availableValue>
		<availableAsField>false</availableAsField>
	</parameter>
	<settingsVariant>
		<dcsset:name>Основной</dcsset:name>
		<dcsset:presentation xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Цены поступления</v8:content>
			</v8:item>
		</dcsset:presentation>
		<dcsset:settings xmlns:style="http://v8.1c.ru/8.1/data/ui/style" xmlns:sys="http://v8.1c.ru/8.1/data/ui/fonts/system" xmlns:web="http://v8.1c.ru/8.1/data/ui/colors/web" xmlns:win="http://v8.1c.ru/8.1/data/ui/colors/windows">
			<dcsset:dataParameters>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>ВыборЦены</dcscor:parameter>
					<dcscor:value xsi:type="xs:string">Средняя цена</dcscor:value>
				</dcscor:item>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>ВыборЕдиницы</dcscor:parameter>
					<dcscor:value xsi:type="xs:string">Максимальный коэффициент</dcscor:value>
				</dcscor:item>
			</dcsset:dataParameters>
		</dcsset:settings>
	</settingsVariant>
</DataCompositionSchema>