#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если ЗначениеЗаполнено(Объект.Ссылка) Тогда
		Цвет = Объект.Ссылка.Цвет.Получить();
	Иначе
		ЗначениеКопирования = Неопределено;
		Параметры.Свойство("ЗначениеКопирования", ЗначениеКопирования);
		Если ЗначениеКопирования <> Неопределено Тогда
			Цвет = ЗначениеКопирования.Цвет.Получить();
		Иначе
			Цвет = Метаданные.ЭлементыСтиля.БазовыйЦветСостояний.Значение;
		КонецЕсли;
	КонецЕсли;
	
	ОтобразитьНовыеДанные(Цвет);
	
КонецПроцедуры

&НаСервере
Процедура ПередЗаписьюНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)

	Если Цвет = Новый Цвет(0, 0, 0) Тогда
		ТекущийОбъект.Цвет = Новый ХранилищеЗначения(Неопределено);
	Иначе
		ТекущийОбъект.Цвет = Новый ХранилищеЗначения(Цвет);
	КонецЕсли;

КонецПроцедуры

&НаКлиенте
Процедура ПослеЗаписи(ПараметрыЗаписи)

	Оповестить("Запись_СостоянияСобытий");

КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийЭлементовФормы

&НаКлиенте
Процедура УстановитьЦвет(Элемент)
	
	ОписаниеОповещения = Новый ОписаниеОповещения(
		"ОбработчикОповещенияЦветВыборНажатие", ЭтотОбъект);
	
	ПараметрыОткрытияФормы = Новый Структура;
	ПараметрыОткрытияФормы.Вставить("Цвет", Цвет);
	
	ОткрытьФорму("ОбщаяФорма.ФормаВыбораЦветаУНФ", ПараметрыОткрытияФормы, ЭтотОбъект, , , , ОписаниеОповещения);
	
КонецПроцедуры

&НаКлиенте
Процедура ОбработчикОповещенияЦветВыборНажатие(Цвет, ДополнительныеПараметры) Экспорт
	
	Если Цвет <> Неопределено И Цвет <> КодВозвратаДиалога.Отмена Тогда
		ОтобразитьНовыеДанные(Цвет);
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервере
Процедура ОтобразитьНовыеДанные(НовыйЦвет)
	Цвет = НовыйЦвет;
	
	Элементы.Цвет.ЦветТекста = Цвет;
	Элементы.Цвет.ЦветФона = Цвет;
КонецПроцедуры

#КонецОбласти