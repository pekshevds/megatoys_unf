
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ИзменитьВидимостьЭлементов();
	
	Если Не ЗначениеЗаполнено(Объект.Ссылка) Тогда
		Объект.Наименование = СформироватьАвтоНаименованиеНаСервере();
		Объект.ВалютаРасчета = Константы.ВалютаУчета.Получить();
	Иначе
		СформироватьАвтоНаименованиеНаСервере();
	КонецЕсли;
	
	Для каждого ВариантНаименования Из Элементы.Наименование.СписокВыбора Цикл
		Если Объект.Наименование = ВариантНаименования.Значение Тогда
			ИспользуетсяАвтоНаименование = Истина;
			Прервать;
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

#КонецОбласти 

#Область ОбработчикиСобытийЭлементовШапкиФормы

&НаКлиенте
Процедура НаименованиеПриИзменении(Элемент)
	
	НаименованиеИзмененоПользователем = Истина;
	
КонецПроцедуры

&НаКлиенте
Процедура НаименованиеАвтоПодбор(Элемент, Текст, ДанныеВыбора, Параметры, Ожидание, СтандартнаяОбработка)
	
	Если Ожидание = 0 Тогда
		СформироватьАвтоНаименованиеНаКлиенте();
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура СпособРасчетаПремийПриИзменении(Элемент)
	
	УстановитьВалютуНачисления();
	
	ОбновитьНаименование();
	
	ИзменитьВидимостьЭлементов();
	
КонецПроцедуры

&НаКлиенте
Процедура ЗначениеРасчетаПремийПриИзменении(Элемент)
	
	ОбновитьНаименование();
	
КонецПроцедуры

&НаКлиенте
Процедура СегментНоменклатурыПриИзменении(Элемент)
	
	ОбновитьНаименование();
	
КонецПроцедуры

&НаКлиенте
Процедура УсловияНачисленияПремийПриИзменении(Элемент)
	
	ОбновитьНаименование();
	
КонецПроцедуры

&НаКлиенте
Процедура ВалютаРасчетаПриИзменении(Элемент)
	
	ОбновитьНаименование();
	
	ИзменитьВидимостьЭлементов();

КонецПроцедуры

&НаКлиенте
Процедура КомментарийНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)

	ОбщегоНазначенияКлиент.ПоказатьФормуРедактированияКомментария(Элемент.ТекстРедактирования, ЭтотОбъект,
		"Объект.Комментарий");

КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервере
Процедура ИзменитьВидимостьЭлементов()
	
	Если Объект.СпособРасчетаПремий = Перечисления.СпособыРасчетаПремийПоЛичнымПродажам.Сумма Тогда
		
		ОбщегоНазначенияКлиентСервер.УстановитьСвойствоЭлементаФормы(Элементы, "ГруппаВалюта", "Видимость", Истина);
		ОбщегоНазначенияКлиентСервер.УстановитьСвойствоЭлементаФормы(Элементы, "ПорядокОкругления", "Видимость", Ложь);
		
	ИначеЕсли Объект.СпособРасчетаПремий = Перечисления.СпособыРасчетаПремийПоЛичнымПродажам.Процент Тогда
		
		ОбщегоНазначенияКлиентСервер.УстановитьСвойствоЭлементаФормы(Элементы, "ГруппаВалюта", "Видимость", Ложь);
		ОбщегоНазначенияКлиентСервер.УстановитьСвойствоЭлементаФормы(Элементы, "ПорядокОкругления", "Видимость", Истина);
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Функция СформироватьАвтоНаименованиеНаКлиенте()
	
	Элементы.Наименование.СписокВыбора.Очистить();
	
	СтрокаНаименования = "";
	
	Если Объект.СпособРасчетаПремий = ПредопределенноеЗначение("Перечисление.СпособыРасчетаПремийПоЛичнымПродажам.Процент") Тогда
		
		Сегмент = ?(ЗначениеЗаполнено(Объект.СегментНоменклатуры),СтрШаблон(НСтр("ru = 'номенклатуры сегмента %1'"), Объект.СегментНоменклатуры),"");
		
		СтрокаНаименования = СтрШаблон(НСтр("ru = 'Премия %1%% от продаж %2'"), Объект.ЗначениеРасчетаПремий, Сегмент);
		
	ИначеЕсли Объект.СпособРасчетаПремий = ПредопределенноеЗначение("Перечисление.СпособыРасчетаПремийПоЛичнымПродажам.Сумма") Тогда
		
		Сегмент = ?(ЗначениеЗаполнено(Объект.СегментНоменклатуры),СтрШаблон(НСтр("ru = 'номенклатуры сегмента %1'"),Объект.СегментНоменклатуры),"");
		
		СтрокаНаименования = СтрШаблон(НСтр("ru = 'Фиксированная премия %1 %2 за продажи %3'"), Объект.ЗначениеРасчетаПремий, Объект.ВалютаРасчета, Сегмент);
		
	КонецЕсли;
	
	Элементы.Наименование.СписокВыбора.Добавить(СтрокаНаименования);
	
	Если Объект.УсловияНачисленияПремий.Количество() = 1 Тогда
		СтрокаНаименования = СтрокаНаименования + "("+Объект.УсловияНачисленияПремий[0].УсловиеНачисления+")";
		Элементы.Наименование.СписокВыбора.Добавить(СтрокаНаименования);
	ИначеЕсли Объект.УсловияНачисленияПремий.Количество() > 1 Тогда
		
		КоличествоУсловий = Объект.УсловияНачисленияПремий.Количество();
		
		Если КоличествоУсловий >= 2 Тогда
			СтрокаНаименования = СтрокаНаименования +НСтр("ru = '(несколько условий)'");
			Элементы.Наименование.СписокВыбора.Добавить(СтрокаНаименования);
		КонецЕсли;
		
	ИначеЕсли Объект.УсловияНачисленияПремий.Количество() = 0 Тогда
		СтрокаНаименования = СтрокаНаименования + НСтр("ru = 'без условий'");
		Элементы.Наименование.СписокВыбора.Добавить(СтрокаНаименования);
	КонецЕсли;
	
	Возврат СтрокаНаименования;
		
КонецФункции

&НаСервере
Функция СформироватьАвтоНаименованиеНаСервере()
	
	Элементы.Наименование.СписокВыбора.Очистить();
	
	СтрокаНаименования = "";
	
	Если Объект.СпособРасчетаПремий = Перечисления.СпособыРасчетаПремийПоЛичнымПродажам.Процент Тогда
		
		Сегмент = ?(ЗначениеЗаполнено(Объект.СегментНоменклатуры),СтрШаблон(НСтр("ru = 'номенклатуры сегмента %1'"), Объект.СегментНоменклатуры),"");
		
		СтрокаНаименования = СтрШаблон(НСтр("ru = 'Премия %1%% от продаж %2'"), Объект.ЗначениеРасчетаПремий, Сегмент);
		
	ИначеЕсли Объект.СпособРасчетаПремий = Перечисления.СпособыРасчетаПремийПоЛичнымПродажам.Сумма Тогда
		
		Сегмент = ?(ЗначениеЗаполнено(Объект.СегментНоменклатуры),СтрШаблон(НСтр("ru = 'номенклатуры сегмента %1'"),Объект.СегментНоменклатуры),"");
		
		СтрокаНаименования = СтрШаблон(НСтр("ru = 'Фиксированная премия %1 %2 за продажи %3'"), Объект.ЗначениеРасчетаПремий, Объект.ВалютаРасчета, Сегмент);
		
	КонецЕсли;
	
	Элементы.Наименование.СписокВыбора.Добавить(СтрокаНаименования);
	
	Если Объект.УсловияНачисленияПремий.Количество() = 1 Тогда
		
		СтрокаНаименования = СтрокаНаименования + "("+Объект.УсловияНачисленияПремий[0].УсловиеНачисления+")";
		Элементы.Наименование.СписокВыбора.Добавить(СтрокаНаименования); 
		
	ИначеЕсли Объект.УсловияНачисленияПремий.Количество() > 1 Тогда
		
		КоличествоУсловий = Объект.УсловияНачисленияПремий.Количество();
		
		Если КоличествоУсловий >= 2 Тогда
			СтрокаНаименования = СтрокаНаименования + НСтр("ru = '(несколько условий)'");
			Элементы.Наименование.СписокВыбора.Добавить(СтрокаНаименования);
		КонецЕсли;
		
	ИначеЕсли Объект.УсловияНачисленияПремий.Количество() = 0 Тогда
		СтрокаНаименования = СтрокаНаименования + НСтр("ru = 'без условий'");
		Элементы.Наименование.СписокВыбора.Добавить(СтрокаНаименования);
	КонецЕсли;
	
	Возврат СтрокаНаименования;
		
КонецФункции

&НаКлиенте
Процедура ОбновитьНаименование()

	Объект.Наименование = СформироватьАвтоНаименованиеНаСервере();

КонецПроцедуры

&НаСервере
Процедура УстановитьВалютуНачисления()
	
	Если Объект.СпособРасчетаПремий = Перечисления.СпособыРасчетаПремийПоЛичнымПродажам.Процент Тогда
		
		Объект.ВалютаРасчета = Константы.ВалютаУчета.Получить();
		
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти


