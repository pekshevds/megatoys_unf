
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ЭтоРасчетыСПокупателями = Параметры.ЭтоРасчетыСПокупателями;
	ТипДокумента = Параметры.ТипДокумента;
	СтрокаИсключений = "";
	Параметры.Свойство("СтрокаИсключений", СтрокаИсключений);
	
	ОтборПоДоговору = Параметры.Отбор.Свойство("Договор");
	Если ОтборПоДоговору Тогда
		Договор = Параметры.Отбор.Договор;
	Иначе
		Договор = Справочники.ДоговорыКонтрагентов.ПустаяСсылка();
	КонецЕсли;
	
	Если ТипДокумента = Тип("ДокументСсылка.ПоступлениеНаСчет")
		ИЛИ ТипДокумента = Тип("ДокументСсылка.ПоступлениеВКассу") Тогда
		
		Если ЭтоРасчетыСПокупателями Тогда
			Список.ТекстЗапроса = ПолучитьТекстЗапросаДокументыРасчетовСПокупателямиПоступление(ОтборПоДоговору);
		Иначе
			Список.ТекстЗапроса = ПолучитьТекстЗапросаДокументыРасчетовСПоставщикамиПоступление(ОтборПоДоговору);
			Список.Параметры.УстановитьЗначениеПараметра("КонтрагентПоУмолчанию", Параметры.Отбор.Контрагент);
		КонецЕсли;
		
	Иначе
		
		Если ЭтоРасчетыСПокупателями Тогда
			Список.ТекстЗапроса = ПолучитьТекстЗапросаДокументыРасчетовСПокупателямиСписание(ОтборПоДоговору, СтрокаИсключений);
		Иначе
			Список.ТекстЗапроса = ПолучитьТекстЗапросаДокументыРасчетовСПоставщикамиСписание(ОтборПоДоговору);
		КонецЕсли;
		
	КонецЕсли;
	
	Список.Параметры.УстановитьЗначениеПараметра("ДоговорПоУмолчанию", Договор);
	
	ДинамическиеСпискиУНФ.ОтображатьТолькоВремяДляТекущейДаты(Список);
	
КонецПроцедуры // ПриСозданииНаСервере()

&НаКлиенте
Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	
	Если ИмяСобытия = "ОповещениеОбИзмененииДолга" Тогда
		Элементы.Список.Обновить();
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийЭлементовТаблицыФормыСписок

&НаКлиенте
Процедура СписокВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	
	ТекущиеДанные = Элементы.Список.ТекущиеДанные;
	
	ДанныеДокумента = Новый Структура;
	ДанныеДокумента.Вставить("Документ", ТекущиеДанные.Ссылка);
	ДанныеДокумента.Вставить("Договор", ТекущиеДанные.Договор);
	
	ДанныеДокумента.Вставить("Заказ", Неопределено);
	ДанныеДокумента.Вставить("СчетНаОплату", Неопределено);
	ДанныеДокумента.Вставить("УстановитьЗаказ", Ложь);
	
	УчетРасчетовСКонтрагентами.ПолучитьЗаказИСчетНаОПлатуПоДокументу(ДанныеДокумента, ЭтоРасчетыСПокупателями);
	
	ОповеститьОВыборе(ДанныеДокумента);
	
КонецПроцедуры // СписокВыбор()

#КонецОбласти

#Область ОбработчикиКомандФормы

// Процедура вызывается при нажатии на кнопку "Выбрать".
//
&НаКлиенте
Процедура ВыбратьДокумент(Команда)
	
	ТекущиеДанные = Элементы.Список.ТекущиеДанные;
	Если ТекущиеДанные <> Неопределено Тогда
		
		ДанныеДокумента = Новый Структура;
		ДанныеДокумента.Вставить("Документ", ТекущиеДанные.Ссылка);
		ДанныеДокумента.Вставить("Договор", ТекущиеДанные.Договор);
		
		ДанныеДокумента.Вставить("Заказ", Неопределено);
		ДанныеДокумента.Вставить("СчетНаОплату", Неопределено);
		ДанныеДокумента.Вставить("УстановитьЗаказ", Ложь);
		
		УчетРасчетовСКонтрагентами.ПолучитьЗаказИСчетНаОПлатуПоДокументу(ДанныеДокумента, ЭтоРасчетыСПокупателями);
		
		ОповеститьОВыборе(ДанныеДокумента);
	Иначе
		Закрыть();
	КонецЕсли;
	
КонецПроцедуры // ВыбратьДокумент()

// Процедура вызывается при нажатии на кнопку "Открыть документ".
//
&НаКлиенте
Процедура ОткрытьДокумент(Команда)
	
	СтрокаТаблицы = Элементы.Список.ТекущиеДанные;
	Если СтрокаТаблицы <> Неопределено Тогда
		ПоказатьЗначение(Неопределено,СтрокаТаблицы.Ссылка);
	КонецЕсли;
	
КонецПроцедуры // ОткрытьДокумент()

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

// Получает запрос для выбора документов расчетов с покупателями 
// для документов "Поступление на счет" и "Поступление в кассу".
//
&НаСервереБезКонтекста
Функция ПолучитьТекстЗапросаДокументыРасчетовСПокупателямиПоступление(ОтборПоДоговору)
	
	ТекстЗапроса = "";
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.АктВыполненныхРабот) Тогда
		ТекстЗапроса = "
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка КАК Ссылка,
		|	ДанныеДокумента.Дата КАК Дата,
		|	ДанныеДокумента.Номер КАК Номер,
		|	ДанныеДокумента.Организация КАК Организация,
		|	ДанныеДокумента.Контрагент КАК Контрагент,
		|	ДанныеДокумента.Договор КАК Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента) КАК Сумма,
		|	ДанныеДокумента.ВалютаДокумента КАК Валюта,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) КАК Тип,
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК СостояниеДокумента,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.АктВыполненныхРабот КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.ЗаказПокупателя) Тогда
		ТекстЗапросаПоЗаказамПокупателей = "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка КАК Ссылка,
		|	ДанныеДокумента.Дата КАК Дата,
		|	ДанныеДокумента.Номер КАК Номер,
		|	ДанныеДокумента.Организация КАК Организация,
		|	ДанныеДокумента.Контрагент КАК Контрагент,
		|	ДанныеДокумента.Договор КАК Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента) КАК СуммаДокумента,
		|	ДанныеДокумента.ВалютаДокумента КАК ВалютаДокумента,
		|	ВЫБОР
		|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.ВидЗаказа) = ТИП(Справочник.ВидыЗаказовПокупателей)
		|			ТОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка)
		|		ИНАЧЕ ""Заказ-наряд""
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.ЗаказПокупателя КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыЗаказНарядов.ПорядокСостояний КАК ВидыЗаказНарядовПорядокСостояний
		|		ПО ДанныеДокумента.ВидЗаказа = ВидыЗаказНарядовПорядокСостояний.Ссылка
		|			И ДанныеДокумента.СостояниеЗаказа = ВидыЗаказНарядовПорядокСостояний.Состояние
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыЗаказов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.СчетНаОплату
		|ГДЕ
		|	ДанныеДокумента.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийЗаказПокупателя.ЗаказНаряд)
		|	И ВидыЗаказНарядовПорядокСостояний.НомерСтроки >= ВЫРАЗИТЬ(ДанныеДокумента.ВидЗаказа КАК Справочник.ВидыЗаказНарядов).НомерСостоянияВыполнения
		|";
		
		
		ТекстЗапросаПоЗаказамПокупателей = СтрЗаменить(ТекстЗапросаПоЗаказамПокупателей, "Заказ-наряд", НСтр("ru = 'Заказ-наряд'"));
		
		ТекстЗапроса = ТекстЗапроса + ТекстЗапросаПоЗаказамПокупателей;
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.Взаимозачет) Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	&ДоговорПоУмолчанию,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаРасчетов),
		|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка),
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.Взаимозачет КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.ОтчетКомиссионера) Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	ДанныеДокумента.Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента),
		|	ДанныеДокумента.ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.ОтчетКомиссионера КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.ОтчетОПереработке) Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	ДанныеДокумента.Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента),
		|	ДанныеДокумента.ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.ОтчетОПереработке КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.ПередачаВА) Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	ДанныеДокумента.Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента),
		|	ДанныеДокумента.ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.ПередачаВА КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.РасходнаяНакладная) Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	ДанныеДокумента.Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента),
		|	ДанныеДокумента.ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.РасходнаяНакладная КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.ПриемИПередачаВРемонт) Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	Null,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента),
		|	ДанныеДокумента.ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.ПриемИПередачаВРемонт КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.ЧекККМ)
		И ПолучитьФункциональнуюОпцию("ИспользоватьРассрочкуПлатежаВЧекахККМ") Тогда
		
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	ДанныеДокумента.Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента),
		|	ДанныеДокумента.ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	НЕОПРЕДЕЛЕНО КАК НомерКартинкиОплаты,
		|	НЕОПРЕДЕЛЕНО КАК ОстатокКОплате
		|ИЗ
		|	Документ.ЧекККМ КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	// Интеркампани
	Если ПравоДоступа("Чтение", Метаданные.Документы.ПередачаТоваровМеждуОрганизациями) Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.КонтрагентПолучатель,
		|	ДанныеДокумента.Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента),
		|	ДанныеДокумента.ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.КонтрагентПолучатель.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.ПередачаТоваровМеждуОрганизациями КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	// Конец Интеркампани
	
	Если Лев(ТекстЗапроса, 10) = "ОБЪЕДИНИТЬ" Тогда
		ТекстЗапроса = Сред(ТекстЗапроса, 14);
	КонецЕсли;
	
	Возврат ТекстЗапроса;
	
КонецФункции // ПолучитьТекстЗапросаДокументыРасчетовСПокупателями()

// Получает запрос для выбора документов расчетов с поставщиками 
// для документов "Поступление на счет" и "Поступление в кассу".
//
&НаСервереБезКонтекста
Функция ПолучитьТекстЗапросаДокументыРасчетовСПоставщикамиПоступление(ОтборПоДоговору)
	
	ТекстЗапроса = "";
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.АвансовыйОтчет) Тогда
		ТекстЗапроса = "
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка КАК Ссылка,
		|	ДанныеДокумента.Дата КАК Дата,
		|	ДанныеДокумента.Номер КАК Номер,
		|	ДанныеДокумента.Организация КАК Организация,
		|	&КонтрагентПоУмолчанию КАК Контрагент,
		|	&ДоговорПоУмолчанию КАК Договор,
		|	ДанныеДокумента.СуммаДокумента КАК Сумма,
		|	ДанныеДокумента.ВалютаДокумента КАК Валюта,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) КАК Тип,
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК СостояниеДокумента,
		|	-1 КАК НомерКартинкиОплаты,
		|	0 КАК ОстатокКОплате
		|ИЗ
		|	Документ.АвансовыйОтчет КАК ДанныеДокумента
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.ДополнительныеРасходы) Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	ДанныеДокумента.Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента),
		|	ДанныеДокумента.ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.ДополнительныеРасходы КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.Взаимозачет) Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	&ДоговорПоУмолчанию,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаРасчетов),
		|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка),
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.Взаимозачет КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.ОтчетКомитенту) Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	ДанныеДокумента.Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента),
		|	ДанныеДокумента.ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.ОтчетКомитенту КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.ОтчетПереработчика) Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	ДанныеДокумента.Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.Сумма),
		|	ДанныеДокумента.ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.ОтчетПереработчика КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.ПриходнаяНакладная) Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	ДанныеДокумента.Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента),
		|	ДанныеДокумента.ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.ПриходнаяНакладная КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.РасходнаяНакладная) Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка КАК Ссылка,
		|	ДанныеДокумента.Дата КАК Дата,
		|	ДанныеДокумента.Номер КАК Номер,
		|	ДанныеДокумента.Организация КАК Организация,
		|	ДанныеДокумента.Контрагент КАК Контрагент,
		|	ДанныеДокумента.Договор КАК Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента) КАК СуммаДокумента,
		|	ДанныеДокумента.ВалютаДокумента КАК ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.РасходнаяНакладная КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.КорректировкаПоступления) Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка КАК Ссылка,
		|	ДанныеДокумента.Дата КАК Дата,
		|	ДанныеДокумента.Номер КАК Номер,
		|	ДанныеДокумента.Организация КАК Организация,
		|	ДанныеДокумента.Контрагент КАК Контрагент,
		|	ДанныеДокумента.Договор КАК Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента) КАК СуммаДокумента,
		|	ДанныеДокумента.ВалютаДокумента КАК ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.КорректировкаПоступления КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.РасходИзКассы) Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	&ДоговорПоУмолчанию,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента),
		|	ДанныеДокумента.ВалютаДенежныхСредств,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.РасходИзКассы КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.РасходСоСчета) Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	&ДоговорПоУмолчанию,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента),
		|	ДанныеДокумента.ВалютаДенежныхСредств,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.РасходСоСчета КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	// Интеркампани
	Если ПравоДоступа("Чтение", Метаданные.Документы.ПередачаТоваровМеждуОрганизациями) Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.ОрганизацияПолучатель,
		|	ДанныеДокумента.КонтрагентВладелец,
		|	ДанныеДокумента.Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента),
		|	ДанныеДокумента.ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.КонтрагентПолучатель.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.ПередачаТоваровМеждуОрганизациями КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	// Конец Интеркампани
	
	Если Лев(ТекстЗапроса, 10) = "ОБЪЕДИНИТЬ" Тогда
		ТекстЗапроса = Сред(ТекстЗапроса, 14);
	КонецЕсли;
	
	Возврат ТекстЗапроса;
	
КонецФункции // ПолучитьТекстЗапросаДокументыРасчетовСПоставщиками()

// Получает запрос для выбора документов расчетов с покупателями 
// для документов "Расход со счета" и "Расход из кассы".
//
&НаСервереБезКонтекста
Функция ПолучитьТекстЗапросаДокументыРасчетовСПокупателямиСписание(ОтборПоДоговору, СтрокаИсключений)
	
	ТекстЗапроса = "";
	
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	НЕОПРЕДЕЛЕНО КАК Ссылка,
	|	НЕОПРЕДЕЛЕНО КАК Дата,
	|	НЕОПРЕДЕЛЕНО КАК Номер,
	|	НЕОПРЕДЕЛЕНО КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК Контрагент,
	|	НЕОПРЕДЕЛЕНО КАК Договор,
	|	НЕОПРЕДЕЛЕНО КАК Сумма,
	|	НЕОПРЕДЕЛЕНО КАК Валюта,
	|	НЕОПРЕДЕЛЕНО КАК Тип,
	|	НЕОПРЕДЕЛЕНО КАК СостояниеДокумента,
	|	НЕОПРЕДЕЛЕНО КАК НомерКартинкиОплаты,
	|	НЕОПРЕДЕЛЕНО КАК ОстатокКОплате
	|ГДЕ
	|	ЛОЖЬ
	|";
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.ПоступлениеВКассу) И СтрНайти(СтрокаИсключений, "ПоступлениеВКассу") = 0 Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка КАК Ссылка,
		|	ДанныеДокумента.Дата КАК Дата,
		|	ДанныеДокумента.Номер КАК Номер,
		|	ДанныеДокумента.Организация КАК Организация,
		|	ДанныеДокумента.Контрагент КАК Контрагент,
		|	&ДоговорПоУмолчанию КАК Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента) КАК Сумма,
		|	ДанныеДокумента.ВалютаДенежныхСредств КАК Валюта,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) КАК Тип,
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК СостояниеДокумента,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.ПоступлениеВКассу КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.ПоступлениеНаСчет) И СтрНайти(СтрокаИсключений, "ПоступлениеНаСчет") = 0 Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	&ДоговорПоУмолчанию КАК Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента) КАК Сумма,
		|	ДанныеДокумента.ВалютаДенежныхСредств,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.ПоступлениеНаСчет КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.АктВыполненныхРабот) И СтрНайти(СтрокаИсключений, "АктВыполненныхРабот") = 0 Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	ДанныеДокумента.Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента) КАК Сумма,
		|	ДанныеДокумента.ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.АктВыполненныхРабот КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.Взаимозачет) И СтрНайти(СтрокаИсключений, "Взаимозачет") = 0 Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	&ДоговорПоУмолчанию КАК Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаРасчетов) КАК Сумма,
		|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка),
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.Взаимозачет КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.ЗаказПокупателя) И СтрНайти(СтрокаИсключений, "ЗаказПокупателя") = 0 Тогда
		ТекстЗапросаПоЗаказамПокупателей = "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка КАК Ссылка,
		|	ДанныеДокумента.Дата КАК Дата,
		|	ДанныеДокумента.Номер КАК Номер,
		|	ДанныеДокумента.Организация КАК Организация,
		|	ДанныеДокумента.Контрагент КАК Контрагент,
		|	ДанныеДокумента.Договор КАК Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента) КАК Сумма,
		|	ДанныеДокумента.ВалютаДокумента КАК ВалютаДокумента,
		|	ВЫБОР
		|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.ВидЗаказа) = ТИП(Справочник.ВидыЗаказовПокупателей)
		|			ТОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка)
		|		ИНАЧЕ ""Заказ-наряд""
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.ЗаказПокупателя КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыЗаказов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.СчетНаОплату
		|ГДЕ
		|	ДанныеДокумента.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийЗаказПокупателя.ЗаказНаряд)
		|";
		
		ТекстЗапросаПоЗаказамПокупателей = СтрЗаменить(ТекстЗапросаПоЗаказамПокупателей, "Заказ-наряд", НСтр("ru = 'Заказ-наряд'"));
		
		ТекстЗапроса = ТекстЗапроса + ТекстЗапросаПоЗаказамПокупателей;
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.ОтчетКомиссионера) И СтрНайти(СтрокаИсключений, "ОтчетКомиссионера") = 0 Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	ДанныеДокумента.Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента),
		|	ДанныеДокумента.ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.ОтчетКомиссионера КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.ОтчетОПереработке) И СтрНайти(СтрокаИсключений, "ОтчетОПереработке") = 0 Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	ДанныеДокумента.Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента),
		|	ДанныеДокумента.ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.ОтчетОПереработке КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.ПередачаВА) И СтрНайти(СтрокаИсключений, "ПередачаВА") = 0 Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	ДанныеДокумента.Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента),
		|	ДанныеДокумента.ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.ПередачаВА КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.ПриходнаяНакладная) И СтрНайти(СтрокаИсключений, "ПриходнаяНакладная") = 0 Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка КАК Ссылка,
		|	ДанныеДокумента.Дата КАК Дата,
		|	ДанныеДокумента.Номер КАК Номер,
		|	ДанныеДокумента.Организация КАК Организация,
		|	ДанныеДокумента.Контрагент КАК Контрагент,
		|	ДанныеДокумента.Договор КАК Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента) КАК СуммаДокумента,
		|	ДанныеДокумента.ВалютаДокумента КАК ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.ПриходнаяНакладная КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.РасходнаяНакладная) И СтрНайти(СтрокаИсключений, "РасходнаяНакладная") = 0 Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	ДанныеДокумента.Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента),
		|	ДанныеДокумента.ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.РасходнаяНакладная КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.КорректировкаРеализации) Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка КАК Ссылка,
		|	ДанныеДокумента.Дата КАК Дата,
		|	ДанныеДокумента.Номер КАК Номер,
		|	ДанныеДокумента.Организация КАК Организация,
		|	ДанныеДокумента.Контрагент КАК Контрагент,
		|	ДанныеДокумента.Договор КАК Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента) КАК СуммаДокумента,
		|	ДанныеДокумента.ВалютаДокумента КАК ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.КорректировкаРеализации КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	// ЧекиККМ
	Если ПравоДоступа("Чтение", Метаданные.Документы.ЧекККМ) И СтрНайти(СтрокаИсключений, "ЧекККМ") = 0 Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка КАК Ссылка,
		|	ДанныеДокумента.Дата КАК Дата,
		|	ДанныеДокумента.Номер КАК Номер,
		|	ДанныеДокумента.Организация КАК Организация,
		|	ДанныеДокумента.Контрагент КАК Контрагент,
		|	ДанныеДокумента.Договор КАК Договор,
		|	ДанныеДокумента.СуммаДокумента КАК СуммаДокумента,
		|	ДанныеДокумента.ВалютаДокумента КАК ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|				И ДанныеДокумента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЧековККМ.Пробит)
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	-1 КАК НомерКартинкиОплаты,
		|	0 КАК ОстатокКОплате
		|ИЗ
		|	Документ.ЧекККМ КАК ДанныеДокумента
		|ГДЕ
		|	ДанныеДокумента.ОперацияСДенежнымиСредствами
		|";
		
	КонецЕсли;
	// Конец ЧекиККМ
	
	// Эквайринг
	Если ПравоДоступа("Чтение", Метаданные.Документы.ОперацияПоПлатежнымКартам) И СтрНайти(СтрокаИсключений, "ОперацияПоПлатежнымКартам") = 0 Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	&ДоговорПоУмолчанию КАК Договор,
		|	ДанныеДокумента.СуммаДокумента,
		|	ДанныеДокумента.ВалютаДенежныхСредств,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	-1 КАК НомерКартинкиОплаты,
		|	0 КАК ОстатокКОплате
		|ИЗ
		|	Документ.ОперацияПоПлатежнымКартам КАК ДанныеДокумента
		|ГДЕ
		|	ДанныеДокумента.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийЭквайринга.ПоступлениеОплатыОтПокупателя)
		|";
		
	КонецЕсли;
	// Конец Эквайринг
	
	// Интеркампани
	Если ПравоДоступа("Чтение", Метаданные.Документы.ПередачаТоваровМеждуОрганизациями) Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.КонтрагентПолучатель,
		|	ДанныеДокумента.Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента),
		|	ДанныеДокумента.ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.КонтрагентПолучатель.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.ПередачаТоваровМеждуОрганизациями КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	// Конец Интеркампани
	
	Если Лев(ТекстЗапроса, 10) = "ОБЪЕДИНИТЬ" Тогда
		ТекстЗапроса = Сред(ТекстЗапроса, 15);
	КонецЕсли;
	
	Возврат ТекстЗапроса;
	
КонецФункции

// Получает запрос для выбора документов расчетов с поставщиками 
// для документов "Расход со счета" и "Расход из кассы".
//
&НаСервереБезКонтекста
Функция ПолучитьТекстЗапросаДокументыРасчетовСПоставщикамиСписание(ОтборПоДоговору)
	
	ТекстЗапроса = "";
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.ДополнительныеРасходы) Тогда
		ТекстЗапроса = "
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка КАК Ссылка,
		|	ДанныеДокумента.Дата КАК Дата,
		|	ДанныеДокумента.Номер КАК Номер,
		|	ДанныеДокумента.Организация КАК Организация,
		|	ДанныеДокумента.Контрагент КАК Контрагент,
		|	ДанныеДокумента.Договор КАК Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента) КАК Сумма,
		|	ДанныеДокумента.ВалютаДокумента КАК Валюта,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) КАК Тип,
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК СостояниеДокумента,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.ДополнительныеРасходы КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.ПриходнаяНакладная) Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	ДанныеДокумента.Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента),
		|	ДанныеДокумента.ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.ПриходнаяНакладная КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.РасходнаяНакладная) Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	ДанныеДокумента.Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента),
		|	ДанныеДокумента.ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.РасходнаяНакладная КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.ОтчетКомитенту) Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	ДанныеДокумента.Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента),
		|	ДанныеДокумента.ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.ОтчетКомитенту КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.ОтчетКомиссионера) Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	&ДоговорПоУмолчанию,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента),
		|	ДанныеДокумента.ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.ОтчетКомиссионера КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.ОтчетПереработчика) Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	ДанныеДокумента.Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.Сумма),
		|	ДанныеДокумента.ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.ОтчетПереработчика КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	Если ПравоДоступа("Чтение", Метаданные.Документы.Взаимозачет) Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.Контрагент,
		|	&ДоговорПоУмолчанию,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаРасчетов),
		|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка),
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.Контрагент.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.Взаимозачет КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	
	// Интеркампани
	Если ПравоДоступа("Чтение", Метаданные.Документы.ПередачаТоваровМеждуОрганизациями) Тогда
		ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ" +
		"
		|ВЫБРАТЬ
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Номер,
		|	ДанныеДокумента.ОрганизацияПолучатель,
		|	ДанныеДокумента.КонтрагентВладелец,
		|	ДанныеДокумента.Договор,
		|	ЕСТЬNULL(ФактОплаты.Сумма, ДанныеДокумента.СуммаДокумента),
		|	ДанныеДокумента.ВалютаДокумента,
		|	ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка),
		|	ВЫБОР
		|		КОГДА ДанныеДокумента.Проведен
		|			ТОГДА 1
		|		КОГДА ДанныеДокумента.ПометкаУдаления
		|			ТОГДА 3
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ ДанныеДокумента.КонтрагентВладелец.ВестиРасчетыПоДокументам
		|				ИЛИ ЕСТЬNULL(ФактОплаты.Сумма, 0) <= 0
		|			ТОГДА -1
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = 0
		|			ТОГДА 2
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) = ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 0
		|		КОГДА ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) + ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) > ЕСТЬNULL(ФактОплаты.Сумма, 0)
		|			ТОГДА 7
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК НомерКартинкиОплаты,
		|	ЕСТЬNULL(ФактОплаты.Сумма, 0) - ЕСТЬNULL(ФактОплаты.СуммаОплаты, 0) - ЕСТЬNULL(ФактОплаты.СуммаАванса, 0) КАК ОстатокКОплате
		|ИЗ
		|	Документ.ПередачаТоваровМеждуОрганизациями КАК ДанныеДокумента
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФактОплатыДокументов КАК ФактОплаты
		|		ПО ДанныеДокумента.Ссылка = ФактОплаты.Документ
		|";
		
	КонецЕсли;
	// Конец Интеркампани
	
	Если Лев(ТекстЗапроса, 10) = "ОБЪЕДИНИТЬ" Тогда
		ТекстЗапроса = Сред(ТекстЗапроса, 14);
	КонецЕсли;
	
	Возврат ТекстЗапроса;
	
КонецФункции

#КонецОбласти
