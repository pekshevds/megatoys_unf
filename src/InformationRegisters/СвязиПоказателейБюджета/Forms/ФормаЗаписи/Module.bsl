#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Свойство("ПоказательБизнеса") Тогда
		СтандартнаяОбработка = Ложь;
		Запись.ПоказательБизнеса = Параметры.ПоказательБизнеса;
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийЭлементов

&НаКлиенте
Процедура ПоказательБизнесаНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	ПараметрыОтбора = ПолучитьПараметрыОтбора();
	
	ОткрытьФорму("Справочник.ПоказателиБизнеса.ФормаВыбора", ПараметрыОтбора, Элементы.ПоказательБизнеса);
	
КонецПроцедуры 

&НаКлиенте
Процедура СвязанныйПоказательБизнесаНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	ПараметрыОтбора = ПолучитьПараметрыОтбора();
	
	ОткрытьФорму("Справочник.ПоказателиБизнеса.ФормаВыбора", ПараметрыОтбора, Элементы.СвязанныйПоказательБизнеса);
	
КонецПроцедуры

&НаКлиенте
Процедура ПоказательБизнесаОбработкаВыбора(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)

	СтандартнаяОбработка = Ложь;
	
	Если ВыбранноеЗначение <> Неопределено Тогда
		Если ПолучитьТипПоказателя(ВыбранноеЗначение) = ПредопределенноеЗначение("Перечисление.ТипыПоказателейБизнеса.Группа") Тогда
			ВыбранноеЗначение = ПредопределенноеЗначение("Справочник.ПоказателиБизнеса.ПустаяСсылка");
			ОбщегоНазначенияКлиент.СообщитьПользователю(НСтр("ru = 'Была выбрана группа. Необходимо выбрать показатель'"));
		ИначеЕсли ВыбранноеЗначение = Запись.СвязанныйПоказательБизнеса Тогда
			ВыбранноеЗначение = ПредопределенноеЗначение("Справочник.ПоказателиБизнеса.ПустаяСсылка");
			ОбщегоНазначенияКлиент.СообщитьПользователю(НСтр("ru = 'Показатель совпадает с зависимым. Необходимо выбрать другой показатель'"));
		КонецЕсли;
	КонецЕсли;
	
	Запись.ПоказательБизнеса = ВыбранноеЗначение;
	

КонецПроцедуры

&НаКлиенте
Процедура СвязанныйПоказательБизнесаОбработкаВыбора(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	Если ВыбранноеЗначение <> Неопределено Тогда
		Если ПолучитьТипПоказателя(ВыбранноеЗначение) = ПредопределенноеЗначение("Перечисление.ТипыПоказателейБизнеса.Группа") Тогда
			ВыбранноеЗначение = ПредопределенноеЗначение("Справочник.ПоказателиБизнеса.ПустаяСсылка");
			ОбщегоНазначенияКлиент.СообщитьПользователю(НСтр("ru = 'Была выбрана группа. Необходимо выбрать показатель'"));
		ИначеЕсли ВыбранноеЗначение = Запись.ПоказательБизнеса Тогда
			ВыбранноеЗначение = ПредопределенноеЗначение("Справочник.ПоказателиБизнеса.ПустаяСсылка");
			ОбщегоНазначенияКлиент.СообщитьПользователю(НСтр("ru = 'Зависимый показатель совпадает с базовым. Необходимо выбрать другой показатель'"));
		КонецЕсли;
	КонецЕсли; 
	
	Запись.СвязанныйПоказательБизнеса = ВыбранноеЗначение;
	
	
КонецПроцедуры


#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаКлиенте
Функция ПолучитьПараметрыОтбора()

	НастройкиКомпоновки = Новый НастройкиКомпоновкиДанных;
	ЭлементОтбора = НастройкиКомпоновки.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	ЭлементОтбора.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("ПоказательБизнеса");
	ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно;
	ЭлементОтбора.ПравоеЗначение = Запись.ПоказательБизнеса;
	
	ПараметрыОтбора = Новый Структура("ПоказательБизнеса", Запись.ПоказательБизнеса);
	Возврат ПараметрыОтбора;

КонецФункции

&НаСервереБезКонтекста
Функция ПолучитьТипПоказателя(Показатель)
	
	Возврат Показатель.ТипПоказателя;
	
КонецФункции 

#КонецОбласти



