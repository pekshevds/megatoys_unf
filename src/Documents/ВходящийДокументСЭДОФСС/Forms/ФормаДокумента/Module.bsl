&НаКлиенте
Перем КонтекстЭДОКлиент;

#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	// Пропускаем инициализацию, чтобы гарантировать получение формы при передаче параметра "АвтоТест".
	Если Параметры.Свойство("АвтоТест") Тогда
		Возврат;
	КонецЕсли;
	
	ЭтоНовый = Параметры.Ключ.Пустая();
	Если ЭтоНовый Тогда
		ТекстПредупреждения = НСтр("ru = 'Копирование входящих сообщений запрещено!'");
		Отказ = Истина;
		Возврат;
	КонецЕсли;
	
	Если НЕ Параметры.Ключ.Пустая() Тогда
		Если НЕ ЗначениеЗаполнено(Параметры.ЗначениеКопирования) Тогда
			Запрос = Новый Запрос;
			Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ ПЕРВЫЕ 1
			|	ОтветСтрахователяНаТребованиеПроверкиФСС.Ссылка КАК Ссылка
			|ИЗ
			|	Документ.ОтветСтрахователяНаТребованиеПроверкиФСС КАК ОтветСтрахователяНаТребованиеПроверкиФСС
			|ГДЕ
			|	ОтветСтрахователяНаТребованиеПроверкиФСС.Основание = &Основание
			|
			|УПОРЯДОЧИТЬ ПО
			|	ОтветСтрахователяНаТребованиеПроверкиФСС.Дата УБЫВ";
			
			Запрос.УстановитьПараметр("Основание", Объект.Ссылка);
			
			
			Результат = Запрос.Выполнить();
			
			Выборка = Результат.Выбрать();
			
			Пока Выборка.Следующий() Цикл
				СформированныйОтвет = Выборка.Ссылка;
			КонецЦикла;
		КонецЕсли;
	КонецЕсли;
	
	Элементы.Организация.Видимость = Не РегламентированнаяОтчетностьВызовСервера.ИспользуетсяОднаОрганизация();
	
	КоличествоФайловПриложений = 0;
	Для каждого ФайлПриложения из Объект.ФайлыПриложений Цикл
		Если НЕ СтрНачинаетсяС(ФайлПриложения.ИмяФайла, "Печатная форма")
			И НЕ ФайлПриложения.ВидФайла = Объект.ВидДокументаФСС Тогда
			КоличествоФайловПриложений = КоличествоФайловПриложений + 1;
		КонецЕсли;
	КонецЦикла;
	ЭтаФорма.КоличествоФайловПриложений = КоличествоФайловПриложений;
	
	УправлениеФормой(ЭтаФорма);
	
	МассивОтветов = ПолучитьОтветыНаТребованиеФСС(Объект.Ссылка);
	ЭтаФорма.КоличествоОтветовВБазе = МассивОтветов.Количество();
	ЭтаФорма.ОшибкиОтветов = ПолучитьОшибкиОтветов();
		
	ОформитьПредставлениеПодтверждения();
	
	Если Объект.ТипСообщения = "303" ИЛИ Объект.ТипСообщения = "308" Тогда
		ОформитьПредставлениеОтвета();
	Иначе
		Элементы.ОтступПередКомментарием.Видимость = Истина;
	КонецЕсли;
	
	Элементы.Вложения.Заголовок = Объект.ВходящийФайл.Наименование +
		"." + Объект.ВходящийФайл.Расширение + 
		" (" + Окр(Объект.ВходящийФайл.Размер / 1024, 2) + "Кб)";
	
	ЭлектронныйДокументооборотСКонтролирующимиОрганами.ОтметитьКакПрочтенное(Объект.Ссылка);
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	ЗаголовокОтветы = "Ответы (" + ПолучитьКоличествоОтветовНаТребованиеФСС(Объект.Ссылка) + ")";
	Элементы.ГиперссылкаОтветы.Заголовок = ЗаголовокОтветы;
	Элементы.ПоказатьОтветы.Заголовок = ЗаголовокОтветы;
	
КонецПроцедуры

&НаСервере
Процедура ПередЗаписьюНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)
	
	Если Не ЗначениеЗаполнено(Объект.Организация)
		И РегламентированнаяОтчетностьВызовСервера.ИспользуетсяОднаОрганизация() Тогда
		Модуль = ОбщегоНазначения.ОбщийМодуль("Справочники.Организации");
		Организация = Модуль.ОрганизацияПоУмолчанию();
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ПриЧтенииНаСервере(ТекущийОбъект)

	// СтандартныеПодсистемы.УправлениеДоступом
	Если ОбщегоНазначения.ПодсистемаСуществует("СтандартныеПодсистемы.УправлениеДоступом") Тогда
		МодульУправлениеДоступом = ОбщегоНазначения.ОбщийМодуль("УправлениеДоступом");
		МодульУправлениеДоступом.ПриЧтенииНаСервере(ЭтотОбъект, ТекущийОбъект);
	КонецЕсли;
	// Конец СтандартныеПодсистемы.УправлениеДоступом
	
	// СтандартныеПодсистемы.ДатыЗапретаИзменения
	Если ОбщегоНазначения.ПодсистемаСуществует("СтандартныеПодсистемы.ДатыЗапретаИзменения") Тогда
		ДатыЗапретаИзменения.ОбъектПриЧтенииНаСервере(ЭтотОбъект, ТекущийОбъект);
	КонецЕсли;
	// Конец СтандартныеПодсистемы.ДатыЗапретаИзменения

КонецПроцедуры

&НаКлиенте
Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	
	Если ИмяСобытия = "Ответ страхователя на запрос, отправлен" Тогда
		ЭтаФорма.Прочитать();
		Если НЕ ЗначениеЗаполнено(Объект.ДатаОтправкиОтветаНаЗапрос) Тогда
			Объект.ДатаОтправкиОтветаНаЗапрос = ТекущаяДата();
			ЭтаФорма.Прочитать();
			Записать();
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ПослеЗаписиНаСервере(ТекущийОбъект, ПараметрыЗаписи)
	
	// СтандартныеПодсистемы.УправлениеДоступом
	Если ОбщегоНазначения.ПодсистемаСуществует("СтандартныеПодсистемы.УправлениеДоступом") Тогда
		МодульУправлениеДоступом = ОбщегоНазначения.ОбщийМодуль("УправлениеДоступом");
		МодульУправлениеДоступом.ПослеЗаписиНаСервере(ЭтотОбъект, ТекущийОбъект, ПараметрыЗаписи);
	КонецЕсли;
	// Конец СтандартныеПодсистемы.УправлениеДоступом
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийЭлементовШапкиФормы

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура КомандаСоздатьОтвет()
	
	СформированныйОтвет = СфомироватьОтветНаСервере(Объект.Ссылка);
	
	Если СформированныйОтвет =
			ПредопределенноеЗначение("Документ.ОтветСтрахователяНаТребованиеПроверкиФСС.ПустаяСсылка")
			ИЛИ СформированныйОтвет = Неопределено Тогда
			
			Возврат;
	КонецЕсли;
		
	ПараметрыФормы = Новый Структура("Ключ", СформированныйОтвет);
	ОткрытьФорму(
		"Документ.ОтветСтрахователяНаТребованиеПроверкиФСС.Форма.ФормаДокумента",
		ПараметрыФормы);
		
	ЗаголовокОтветы = "Ответы (" + ПолучитьКоличествоОтветовНаТребованиеФСС(Объект.Ссылка) + ")";
	Элементы.ПоказатьОтветы.Заголовок = ЗаголовокОтветы;
	
	УправлениеФормой(ЭтаФорма);
	ОформитьПредставлениеПодтверждения();
	
КонецПроцедуры

&НаКлиенте
Процедура СоздатьЗаявлениеНаСправкуОРасчетах(Команда)
	
	ФормаДокумента = "Документ.ЗаявлениеНаФормированиеСправкиОРасчетах.Форма.ФормаДокумента";
	
	ПараметрыФормы = Новый Структура;
	ПараметрыФормы.Вставить("ЗначенияЗаполнения",
		Новый Структура("Организация, ДатаЗадолженности", Объект.Организация, НачалоМесяца(ТекущаяДата())));
	
	ОткрытьФорму(ФормаДокумента, ПараметрыФормы, ЭтотОбъект, Новый УникальныйИдентификатор);
	
КонецПроцедуры

&НаКлиенте
Процедура КомандаПодтвердитьПрием(Команда)
	
	Если НЕ ЗначениеЗаполнено(Объект.Организация) Тогда
		ЗаполнитьСтрахователя(Объект.ИдентификаторСообщения);
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.ДатаОтправкиПодтверждения) Тогда
		Оповещение = Новый ОписаниеОповещения("ПодтвердитьПриемПослеВопросаОПовторе", ЭтотОбъект);
		Шаблон = НСтр("ru='Подтверждение получения было отправлено %1. Отправить повторно?'");
		ТекстВопроса = СтрШаблон(Шаблон, Объект.ДатаОтправкиПодтверждения);
		ПоказатьВопрос(Оповещение, ТекстВопроса, РежимДиалогаВопрос.ОКОтмена, , КодВозвратаДиалога.Отмена);
		Возврат;
	КонецЕсли;
	
	ПодтвердитьПриемПослеВопросаОПовторе(КодВозвратаДиалога.ОК, Неопределено);
	
КонецПроцедуры

&НаКлиенте
Процедура ВложенияНажатие(Элемент)
	
	ФайлСсылка = Объект.ВходящийФайл;
	
	Если Объект.ФайлыПриложений.Количество() > 0 Тогда
		
		ВидФайла = "Печатная форма " + Объект.ВидДокументаФСС;
		Для каждого ДанныеФайла из Объект.ФайлыПриложений Цикл
			ВидФайлаПриложения = СтрЗаменить(ДанныеФайла.ВидФайла, "Печатная форма ", "");
			Если СтрНачинаетсяС(Объект.ВидДокументаФСС, ВидФайлаПриложения)
				ИЛИ ДанныеФайла.ВидФайла = ВидФайла Тогда
				
				ФайлСсылка = ДанныеФайла.ФайлПриложения;
				Прервать;
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
	
	ДанныеФайла = РаботаСФайламиСлужебныйВызовСервера.ДанныеФайлаДляОткрытия(ФайлСсылка,
		Неопределено, УникальныйИдентификатор, Неопределено);
	РаботаСФайламиКлиент.ОткрытьФайл(ДанныеФайла, Ложь);
	
КонецПроцедуры

&НаКлиенте
Процедура ВложенияКОсновномуДокументуНажатие(Элемент)
	
	ДополнительныеПараметры = Новый Структура();
	ДополнительныеПараметры.Вставить("Основание", Объект.Ссылка);
	
	ОткрытьФорму(
		"Документ.ВходящийДокументСЭДОФСС.Форма.ФормаФайлыПриложений",
		ДополнительныеПараметры,,,,,,
		РежимОткрытияОкнаФормы.БлокироватьОкноВладельца);
	
КонецПроцедуры

&НаКлиенте
Процедура ПоказатьОтветыНажатие(Элемент)
	
	НажатиеНаКнопкуПоказатьОтветыПоТребованию();
	
КонецПроцедуры

&НаКлиенте
Процедура ГиперссылкаОтветыНажатие(Элемент)
	
	НажатиеНаКнопкуПоказатьОтветыПоТребованию();
	
КонецПроцедуры

&НаКлиенте
Процедура СсылкаСрокиНажатие(Элемент)
	
	ЭлектронныйДокументооборотСФССКлиент.ПоказатьИнформациюоСроках();
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаКлиентеНаСервереБезКонтекста
Процедура УправлениеФормой(Форма)
	
	Элементы 	= Форма.Элементы;
	Объект 		= Форма.Объект;
	
	Форма.Заголовок = Объект.ВидДокументаФСС
		+ " СФР (бывш. ФСС) "
		+ Формат(Объект.ВходящийНомер, "ЧГ=")
		+ " от "
		+ Формат(Объект.ВходящаяДата, "ДФ=dd.MM.yyyy");
	Элементы.НаименованиеЭтапа.Заголовок = Объект.Статус;
	Если Объект.Статус = "" Тогда
		Элементы.НаименованиеЭтапа.Заголовок = "Подтвердите прием";
		Элементы.ОбновитьОтправку.Видимость = Ложь;
		Если ЗначениеЗаполнено(Объект.ДатаОтправкиПодтверждения) Тогда
			Элементы.НаименованиеЭтапа.Заголовок = "Прием подтвержден";
		КонецЕсли;
	КонецЕсли;
	
	Если Объект.Статус = "Подтвердите прием" Тогда
		Элементы.ОбновитьОтправку.Видимость = Ложь;
	КонецЕсли;
	
	Форма.Отправитель = "Орган СФР "+ Объект.Отправитель + " (" + Объект.КодОтправителя + ")";
	
	Если Объект.ТипСообщения = "303" ИЛИ Объект.ТипСообщения = "308" Тогда
		Элементы.ГруппаЗапрашиваемыеДокументы.Видимость = Истина;
		Элементы.ГруппаОшибокОтвета.Видимость			= Форма.ОшибкиОтветов > 0;
	Иначе
		Элементы.ГиперссылкаОтветы.Видимость			= Ложь;
		Элементы.ПоказатьОтветы.Видимость				= Ложь;
		Элементы.ГруппаЗапрашиваемыеДокументы.Видимость	= Ложь;
		Элементы.ГруппаОтветаНаТребование.Видимость		= Ложь;
		Элементы.ГруппаБезПарсинга.Видимость			= Ложь;
		Элементы.КомандаСоздатьОтвет.Видимость			= Ложь;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.ТребуетсяПодтверждение) Тогда
		Если НЕ ЗначениеЗаполнено(Объект.ДатаОтправкиПодтверждения) Тогда
			Элементы.БлокОшибокИИзвещений.Видимость = Истина;
		Иначе
			Элементы.БлокОшибокИИзвещений.Видимость = Ложь;
		КонецЕсли;
	Иначе
		Элементы.БлокОшибокИИзвещений.Видимость = Ложь;
	КонецЕсли;
	
	Если Форма.КоличествоФайловПриложений > 0 Тогда
		Шаблон = НСтр("ru='Файлы приложений (%1)'");
		ТекстЗаголовка = СтрШаблон(Шаблон, Форма.КоличествоФайловПриложений);
		Элементы.ВложенияКОсновномуДокументу.Заголовок = ТекстЗаголовка;
		Элементы.ГруппаФайлыПриложений.Видимость = Истина;
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ОформитьПредставлениеПодтверждения()
	
	Элементы.БлокНеотправленныхИзвещений.Видимость = НЕ ЗначениеЗаполнено(Объект.ДатаОтправкиПодтверждения);
	
	Состояние = Новый Структура;
	Состояние.Вставить("ОсталосьДоПодтверждения",
		Окр((Объект.МаксимальнаяДатаПодтверждения - ТекущаяДатаСеанса()) / 24 / 60 / 60));
	Состояние.Вставить("Подтвержден", ЗначениеЗаполнено(Объект.ДатаОтправкиПодтверждения));
	Состояние.Вставить("ПодтвердитьДо", Объект.МаксимальнаяДатаПодтверждения);
	Состояние.Вставить("ПодтверждениеПросроченоНа",
		Окр((ТекущаяДатаСеанса() - Объект.МаксимальнаяДатаПодтверждения) / 24 / 60 / 60));
	Состояние.Вставить("ДатаПодтверждения", Объект.ДатаОтправкиПодтверждения);
	
	Сейчас = ТекущаяДатаСеанса();
	Результат = ТребованияФНС.ПредставлениеПодтверждения(Состояние, Сейчас);
	
	Элементы.ДатаПриемаПредставление.Заголовок = СтроковыеФункции.ФорматированнаяСтрока(Результат.Представление);
	Элементы.ОгонекПодтверждения.Видимость = Результат.ДобавитьОгонек;
	
КонецПроцедуры

&НаСервере
Процедура ОформитьПредставлениеОтвета()
	
	Состояние = Новый Структура;
	Состояние.Вставить("ОсталосьДоОтвета",
		Окр((Объект.МаксимальнаяДатаОтправкиОтвета - ТекущаяДатаСеанса()) / 24 / 60 / 60));
	Состояние.Вставить("Подтвержден", Истина);
	Состояние.Вставить("ТребуетОтвета", ?(Объект.ТипСообщения = "303" ИЛИ Объект.ТипСообщения = "308", Истина, Ложь));
	Состояние.Вставить("ОтветУжеДан", Ложь);
	Состояние.Вставить("ЕстьОтправленныеОтветы", ?(КоличествоОтветовВБазе = 0, Ложь, Истина));
	Состояние.Вставить("ЕстьОтвет", ?(КоличествоОтветовВБазе = 0, Ложь, Истина));
	Состояние.Вставить("ОтветитьДо", Объект.МаксимальнаяДатаОтправкиОтвета);
	Состояние.Вставить("ДнейДоОтвета",
		Окр((Объект.МаксимальнаяДатаОтправкиОтвета - ТекущаяДатаСеанса()) / 24 / 60 / 60));
	Состояние.Вставить("КоличествоОтветов", КоличествоОтветовВБазе);
	Состояние.Вставить("ДатаОтвета", Объект.ДатаОтправкиОтветаНаЗапрос);
	Состояние.Вставить("ОтветНеПринят", Объект.ОшибкиЛогическогоКонтроля.Количество() > 0);
	
	Сейчас = ТекущаяДатаСеанса();
	Результат = ТребованияФНС.ПредставлениеОтвета(Состояние, Сейчас);
	
	Элементы.ПоказатьОтветы.Видимость = Результат.ПоказатьОтветы;
	Элементы.ПоказатьОтветы.Заголовок = Результат.ПредставлениеСсылки;
	Элементы.ГиперссылкаОтветы.Видимость = Результат.ПоказатьОтветы;
	Элементы.ДатаОтветаПредставление.Заголовок = СтроковыеФункции.ФорматированнаяСтрока(Результат.Представление);
	Элементы.ОгонекОтвета.Видимость = Результат.ДобавитьОгонек;

КонецПроцедуры

&НаКлиенте
Процедура ПодтвердитьПриемПослеВопросаОПовторе(Результат, ДополнительныеПараметры) Экспорт
	
	Обработчик = Новый ОписаниеОповещения("ПодтвердитьПриемПослеПодтверждениеПолучения", ЭтотОбъект);
	ЭлектронныйДокументооборотСФССКлиент.ОтправитьПодтверждениеОПолученииСообщенийСЭДО(
		Обработчик, Объект.Организация, Объект.ИдентификаторСообщения, Ложь);
	
КонецПроцедуры

&НаКлиенте
Процедура ПодтвердитьПриемПослеПодтверждениеПолучения(РезультатОтправки, ДополнительныйПараметры) Экспорт
	
	Контекст = Новый Структура;
	
	// Чтение результатов отправки.
	Если РезультатОтправки <> Неопределено Тогда
		Если РезультатОтправки.Свойство("ОписаниеОшибки") И ЗначениеЗаполнено(РезультатОтправки.ОписаниеОшибки) Тогда
			ОбщегоНазначенияКлиент.СообщитьПользователю(РезультатОтправки.ОписаниеОшибки);
		КонецЕсли;
		Если РезультатОтправки.Свойство("Выполнено") И РезультатОтправки.Выполнено Тогда
			Объект.ДатаОтправкиПодтверждения = ТекущаяДата();
			Объект.Статус = "Получено";
			Если ПолучитьОтправленныеОтветы() > 0 Тогда
				Объект.Статус = "Отправлено";
			КонецЕсли;
			Записать();
			УправлениеФормой(ЭтаФорма);
			ОформитьПредставлениеПодтверждения();
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Функция СфомироватьОтветНаСервере(Ссылка)
	
	Результат = Неопределено;
	
	Попытка
		Ответ = Документы.ОтветСтрахователяНаТребованиеПроверкиФСС.СоздатьДокумент();
		
		Ответ.Дата 		= ТекущаяДатаСеанса();
		Ответ.Основание	= Ссылка;
		
		Ответ.УстановитьВремя();
		Ответ.УстановитьНовыйНомер();
		
		Ответ.Заполнить(Ссылка);
		
		Ответ.Записать();
		
		Результат = Ответ.Ссылка;
	Исключение
		ОбщегоНазначения.СообщитьПользователю(НСтр("ru = 'Невозможно сформировать ответ.'"));
	КонецПопытки;
	
	Возврат Результат;
	
КонецФункции

&НаКлиенте
Функция ПолучитьКоличествоОтветовНаТребованиеФСС(Ссылка)
	
	КоличествоОтветов = ПолучитьОтветыНаТребованиеФСС(Ссылка);
	
	КоличествоОтветов = ?(КоличествоОтветов = Неопределено, 0, КоличествоОтветов.Количество());
	
	Возврат КоличествоОтветов;
	
КонецФункции

&НаСервере
Функция ПолучитьОтветыНаТребованиеФСС(Ссылка)
	
	МассивОтветов = Новый Массив;
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	|	ОтветСтрахователяНаТребованиеПроверкиФСС.Ссылка КАК Ответ
	|ИЗ
	|	Документ.ОтветСтрахователяНаТребованиеПроверкиФСС КАК ОтветСтрахователяНаТребованиеПроверкиФСС
	|ГДЕ
	|	ОтветСтрахователяНаТребованиеПроверкиФСС.Основание = &Основание";
	
	Запрос.УстановитьПараметр("Основание", Ссылка);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	Если РезультатЗапроса.Пустой() Тогда
		Возврат МассивОтветов;
	Иначе
		Выгрузка = РезультатЗапроса.Выгрузить();
		
		МассивОтветов = Выгрузка.ВыгрузитьКолонку("Ответ");
	КонецЕсли;
	
	Возврат МассивОтветов;
	
КонецФункции

&НаКлиенте
Процедура ОбновитьОтправку(Команда)
	
	ОписаниеОповещения = Новый ОписаниеОповещения(
		"ОбновитьОтправкуПослеПолученияКонтекста", 
		ЭтотОбъект);
		
	ДокументооборотСКОКлиент.ПолучитьКонтекстЭДО(ОписаниеОповещения);
	
КонецПроцедуры
	
&НаКлиенте
Процедура ОбновитьОтправкуПослеПолученияКонтекста(Результат, ДополнительныеПараметры) Экспорт
	
	Если Результат.КонтекстЭДО = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	КонтекстЭДОКлиент = Результат.КонтекстЭДО;
	
	ОповещениеОбратногоВызова = Новый ОписаниеОповещения("ОбновитьОтправкуПослеПолучения", ЭтотОбъект);
	Организации = Новый Массив;
	Организации.Добавить(Объект.Организация);
	КонтекстЭДОКлиент.ПолучитьВходящиеСообщенияСЭДОФСС(
		ОповещениеОбратногоВызова,
		Организации,
		Истина,
		Истина);
	
КонецПроцедуры

&НаКлиенте
Процедура ОбновитьОтправкуПослеПолучения(Результат, ДополнительныеПараметры) Экспорт
	
	Прочитать();
	УправлениеФормой(ЭтаФорма);
	
КонецПроцедуры

&НаКлиенте
Процедура НажатиеНаКнопкуПоказатьОтветыПоТребованию()
	
	КоличествоОтветов = ПолучитьОтветыНаТребованиеФСС(Объект.Ссылка);
	
	Если КоличествоОтветов = Неопределено Тогда
		
		ДлительнаяОтправкаКлиентСервер.ВывестиОшибку(НСтр("ru = 'Ответы отсутствуют'"));
		Возврат;
		
	КонецЕсли;
		
	Если КоличествоОтветов.Количество() > 1 Тогда
		
		ДополнительныеПараметры = Новый Структура();
		ДополнительныеПараметры.Вставить("Основание", Объект.Ссылка);
	
		ОткрытьФорму(
			"Обработка.ДокументооборотСКонтролирующимиОрганами.Форма.ОтветыНаТребованияФСС",
			ДополнительныеПараметры,,
			Новый УникальныйИдентификатор);
		
	Иначе
		
		ПоказатьЗначение(, КоличествоОтветов[0]);
		
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Функция ПолучитьОтправленныеОтветы()
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ ПЕРВЫЕ 1
	|	УведомленияОПриемеОтказе.ОтветНаТребованиеФСС КАК ОтветНаТребованиеФСС
	|ИЗ
	|	Документ.ВходящийДокументСЭДОФСС.УведомленияОПриемеОтказе КАК УведомленияОПриемеОтказе
	|ГДЕ
	|	УведомленияОПриемеОтказе.Ссылка = &Основание";
	
	Запрос.УстановитьПараметр("Основание", Объект.Ссылка);
	
	Результат = Запрос.Выполнить();
	Выгрузка = Результат.Выгрузить();
	
	Возврат Выгрузка.Количество();
	
КонецФункции

&НаСервере
Функция ПолучитьОшибкиОтветов()
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ ПЕРВЫЕ 1
	|	ОтветСтрахователяНаТребованиеПроверкиФСС.Ссылка КАК Ссылка
	|ПОМЕСТИТЬ ВТОтветы
	|ИЗ
	|	Документ.ОтветСтрахователяНаТребованиеПроверкиФСС КАК ОтветСтрахователяНаТребованиеПроверкиФСС
	|ГДЕ
	|	ОтветСтрахователяНаТребованиеПроверкиФСС.Основание = &Основание
	|
	|УПОРЯДОЧИТЬ ПО
	|	ОтветСтрахователяНаТребованиеПроверкиФСС.Дата УБЫВ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ОшибкиЛогическогоКонтроля.СодержимоеОшибки КАК СодержимоеОшибки
	|ИЗ
	|	ВТОтветы КАК ВТОтветы
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ВходящийДокументСЭДОФСС.ОшибкиЛогическогоКонтроля КАК ОшибкиЛогическогоКонтроля
	|		ПО ВТОтветы.Ссылка = ОшибкиЛогическогоКонтроля.ОтветНаТребованиеФСС";
	
	Запрос.УстановитьПараметр("Основание", Объект.Ссылка);
	
	Результат = Запрос.Выполнить();
	Если Результат.Пустой() Тогда
		Возврат 0;
	Иначе
		Возврат 1;
	КонецЕсли;
	
КонецФункции

&НаСервере
Процедура ЗаполнитьСтрахователя(ИдентификаторСообщения)
	
	Если НЕ ЗначениеЗаполнено(ИдентификаторСообщения) Тогда
		Возврат;
	КонецЕсли;
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	|	ВходящиеСообщенияСЭДОФСС.Организация КАК Организация
	|ИЗ
	|	РегистрСведений.ВходящиеСообщенияСЭДОФСС КАК ВходящиеСообщенияСЭДОФСС
	|ГДЕ
	|	ВходящиеСообщенияСЭДОФСС.Идентификатор = &Идентификатор";
	
	Запрос.УстановитьПараметр("Идентификатор", ИдентификаторСообщения);
	
	Результат = Запрос.Выполнить();
	
	Если Результат.Пустой() Тогда
		Возврат;
	КонецЕсли;
	
	Выборка = Результат.Выбрать();
	
	Пока Выборка.Следующий() Цикл
		Объект.Организация = Выборка.Организация;
		Записать();
		Прочитать();
	КонецЦикла;
	
КонецПроцедуры

#КонецОбласти
