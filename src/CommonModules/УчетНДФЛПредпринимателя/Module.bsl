////////////////////////////////////////////////////////////////////////////////
// Подсистема "Индивидуальный предприниматель"
////////////////////////////////////////////////////////////////////////////////

#Область ПрограммныйИнтерфейс

// Возвращает дату начала применения схемы расчета авансовых платежей предпринимателем
// (п. 7 ст. 1 Федерального закона от 15.04.2019 N 63-ФЗ)
//
// Возвращаемое значение:
//   Дата
//
Функция ДатаНачалаРасчетаАвансовыхПлатежейНДФЛ() Экспорт
	
	Возврат Дата('20200101');
	
КонецФункции

// Возвращает период, за который уплачивается налог.
//
// Параметры:
//  ПоказательПериода - Строка - Показатель периода платежа в бюджет.
//  ДатаПлатежа       - Дата - дата платежного документа.
//
// Возвращаемое значение:
//   Дата - начало квартала, за который уплачивается налог;
//          для налога за год - начало последнего квартала в году.
//
Функция НалоговыйПериодПоПлатежнымДанным(ПоказательПериода, ДатаПлатежа) Экспорт
	
	ОписаниеПериода = ПлатежиВБюджетКлиентСервер.РазобратьНалоговыйПериод(ПоказательПериода);
	
	Если ОписаниеПериода.Периодичность = ПлатежиВБюджетКлиентСервер.НезаполненноеЗначение() Тогда
		
		НалоговыйПериод = НачалоМесяца(ДобавитьМесяц(ДатаПлатежа, -1));
		
	ИначеЕсли ОписаниеПериода.Периодичность = ПлатежиВБюджетКлиентСервер.ПериодичностьГод() Тогда
		
		НалоговыйПериод = НачалоКвартала(КонецГода(ОписаниеПериода.Дата));
		
	ИначеЕсли ОписаниеПериода.Периодичность = ПлатежиВБюджетКлиентСервер.ПериодичностьПолугодие() Тогда
		
		НалоговыйПериод = НачалоКвартала(ДобавитьМесяц(ОписаниеПериода.Дата, 3));
		
	ИначеЕсли ОписаниеПериода.Периодичность = ПлатежиВБюджетКлиентСервер.ПериодичностьКвартал()
		Или ОписаниеПериода.Периодичность = ПлатежиВБюджетКлиентСервер.ПериодичностьМесяц() Тогда
		
		НалоговыйПериод = НачалоКвартала(ОписаниеПериода.Дата);
		
	Иначе
		
		НалоговыйПериод = ДатаПлатежа;
		
	КонецЕсли;
	
	Возврат НалоговыйПериод;
	
КонецФункции

// Определяет периодичность налогового платежа в зависимости от оплачиваемого периода.
//
// Параметры:
//  НалоговыйПериод - Дата - оплачиваемый период
//
// Возвращаемое значение:
//   ПеречислениеСсылка.Периодичность, возможные значения:
//    * Год, если платеж за последний квартал (налог за год)
//    * Квартал, если платеж за все остальные кварталы (авансовый платеж).
Функция ПериодичностьНалоговогоПлатежа(НалоговыйПериод) Экспорт
	
	Если КонецКвартала(НалоговыйПериод) = КонецГода(НалоговыйПериод) Тогда
		// Платеж за последний квартал года - это налог за год.
		Возврат Перечисления.Периодичность.Год;
	Иначе
		// За периоды кроме последнего квартала года уплачивается ежеквартальный авансовый платеж.
		Возврат Перечисления.Периодичность.Квартал;
	КонецЕсли;
	
КонецФункции

// Возвращает наиболее вероятный период (квартал), за который уплачивается НДФЛ
//
// Параметры:
//   ДатаПлатежа - Дата - Дата платежа фактическая
//
// Возвращаемое значение:
//   Дата - начало квартала, за который выполняется платеж
//
Функция РелевантныйПериодНалоговогоПлатежа(ДатаПлатежа) Экспорт
	
	// Обработаем наиболее вероятные сценарии:
	// - до 15 июля - оплата налога за год
	// - в срок с начала апреля до 25 апреля - уплата авансового платежа
	// - после 15 июля - уплата авансового платежа
	
	ДеньУплатыАвансаПоУмолчанию = ДеньУплатыАвансовогоПлатежаПоУмолчанию();
	СрокУплатыНалогаЗаГод = СрокУплатыНалогаПоУмолчанию(ДобавитьМесяц(ДатаПлатежа, -12));
	
	Если Месяц(ДатаПлатежа) = 4 И День(ДатаПлатежа) <= ДеньУплатыАвансаПоУмолчанию Тогда
		
		НалоговыйПериод = НачалоКвартала(ДобавитьМесяц(ДатаПлатежа, -3));
		
	ИначеЕсли ДатаПлатежа < СрокУплатыНалогаЗаГод Тогда
		
		НалоговыйПериод = НачалоКвартала(НачалоГода(ДатаПлатежа) - 1);
		
	Иначе
		
		НалоговыйПериод = НачалоКвартала(ДобавитьМесяц(ДатаПлатежа, -3));
		
	КонецЕсли;
	
	Возврат НалоговыйПериод;
	
КонецФункции

// Возвращает календарный срок уплаты налога на доходы физических лиц
//
// Параметры:
//   Период - Дата - Дата в пределах года, за который определяется срок уплаты налога
//
// Возвращаемое значение:
//   Дата
//
Функция СрокУплатыНалогаПоУмолчанию(Период) Экспорт
	
	Возврат Дата(Год(Период) + 1, 07, 15);
	
КонецФункции

#КонецОбласти

Функция ДеньУплатыАвансовогоПлатежаПоУмолчанию()
	
	Возврат 25;
	
КонецФункции
