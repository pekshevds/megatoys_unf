#Область ПрограммныйИнтерфейс

#Область РаботаСФормойЭкземпляраОфлайнОборудования

// Дополнительные переопределяемые действия с управляемой формой в Экземпляре оборудования
// при событии "ПриСозданииНаСервере".
//
// Параметры:
//  Объект - СправочникОбъект.ОфлайнОборудование - 
//  ЭтаФорма - ФормаКлиентскогоПриложения - 
//  Отказ - Булево - Признак отказа от создания формы
//  Параметры - ДанныеФормыСтруктура - параметры формы
//  СтандартнаяОбработка - Булево - признак выполнения стандартной обработки
//
Процедура ЭкземплярОфлайнОборудованияПриСозданииНаСервере(Объект, ЭтаФорма, Отказ, Параметры, СтандартнаяОбработка) Экспорт
	
	Элемент = ЭтаФорма.Элементы.Добавить("ПравилоОбмена", Тип("ПолеФормы"));
	Элемент.Вид = ВидПоляФормы.ПолеВвода;
	Элемент.ПутьКДанным = "Объект.ПравилоОбмена";
	
	Если Объект.ТипОфлайнОборудования = Перечисления.ТипыОфлайнОборудования.ККМ Тогда
		НовыйПараметр = Новый ПараметрВыбора("Отбор.ТипПодключаемогоОборудования", Перечисления.ТипыОфлайнОборудования.ККМ);
	Иначе
		НовыйПараметр = Новый ПараметрВыбора("Отбор.ТипПодключаемогоОборудования", Перечисления.ТипыОфлайнОборудования.ПрайсЧекер);
	КонецЕсли;
	
	ПараметрыВыбораЭлемента = Новый Массив;
	ПараметрыВыбораЭлемента.Добавить(НовыйПараметр);
	ПараметрыВыбораПравилаОбмена = Новый ФиксированныйМассив(ПараметрыВыбораЭлемента);
	Если ЗначениеЗаполнено(ПараметрыВыбораПравилаОбмена) Тогда
		ЭтаФорма.Элементы.ПравилоОбмена.ПараметрыВыбора = ПараметрыВыбораПравилаОбмена;
	КонецЕсли;
	
	Если Объект.ТипОфлайнОборудования = Перечисления.ТипыОфлайнОборудования.ОФД Тогда
		ЭтаФорма.Элементы.ПравилоОбмена.Видимость = Ложь;
	КонецЕсли;
	
КонецПроцедуры

// Дополнительные переопределяемые действия с управляемой формой в Экземпляре оборудования
// при событии "ПриЧтенииНаСервере".
//
// Параметры:
//  ТекущийОбъект - СправочникОбъект.ОфлайнОборудование - Объект, который будет прочитан.
//  ЭтаФорма - ФормаКлиентскогоПриложения
//
Процедура ЭкземплярОфлайнОборудованияПриЧтенииНаСервере(ТекущийОбъект, ЭтаФорма) Экспорт

КонецПроцедуры

// Дополнительные переопределяемые действия с управляемой формой в Экземпляре оборудования
// при событии "ПередЗаписьюНаСервере".
//
// Параметры:
//  Отказ - Булево - Признак отказа от записи
//  ТекущийОбъект - СправочникОбъект.ОфлайнОборудование - Записываемый объект
//  ПараметрыЗаписи - Структура - Структура, содержащая параметры записи.
//
Процедура ЭкземплярОфлайнОборудованияПередЗаписьюНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи) Экспорт

КонецПроцедуры

// Дополнительные переопределяемые действия с управляемой формой в Экземпляре оборудования
// при событии "ПриЗаписиНаСервере".
//
// Параметры:
//  Отказ - Булево - Признак отказа от записи
//  ТекущийОбъект - СправочникОбъект.ОфлайнОборудование - Записываемый объект
//  ПараметрыЗаписи - Структура - Структура, содержащая параметры записи.
//
Процедура ЭкземплярОфлайнОборудованияПриЗаписиНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи) Экспорт

КонецПроцедуры

// Дополнительные переопределяемые действия с управляемой формой в Экземпляре оборудования
// при событии "ПослеЗаписиНаСервере".
//
// Параметры:
//  ТекущийОбъект - СправочникОбъект.ОфлайнОборудование - Записанный объект
//  ПараметрыЗаписи - Структура - Структура, содержащая параметры записи.
//
Процедура ЭкземплярОфлайнОборудованияПослеЗаписиНаСервере(ТекущийОбъект, ПараметрыЗаписи) Экспорт

КонецПроцедуры

// Дополнительные переопределяемые действия с управляемой формой в Экземпляре оборудования
// при событии "ОбработкаПроверкиЗаполненияНаСервере".
//
// Параметры:
//  Объект - СправочникОбъект.ОфлайнОборудование
//  ЭтаФорма - ФормаКлиентскогоПриложения
//  Отказ - Булево - Признак отказа от создания формы
//  ПроверяемыеРеквизиты - Массив - Массив путей к реквизитам, для которых будет выполнена проверка заполнения.
//
Процедура ЭкземплярОфлайнОборудованияОбработкаПроверкиЗаполненияНаСервере(Объект, ЭтаФорма, Отказ, ПроверяемыеРеквизиты) Экспорт

КонецПроцедуры

// Дополнительные переопределяемые действия при переносе элемента офлайн оборудования из справочника ПодключаемоеОборудование
// в справочник ОфлайнОборудование.
//
// Параметры:
//  СсылкаНаПодключаемоеОборудование - СправочникСсылка.ПодключаемоеОборудование - ссылка на перемещаемый элемент
//  СсылкаНаОфлайнОборудование - СправочникСсылка.ОфлайнОборудование - ссылка на аналогичный объект в справочнике ОфлайнОборудование
//
Процедура ОбработатьПереходСправочникаПодключаемоеОборудованиеНаОфлайнОборудование(СсылкаНаПодключаемоеОборудование, СсылкаНаОфлайнОборудование) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	КассыККМ.Ссылка КАК Ссылка
	               |ИЗ
	               |	Справочник.КассыККМ КАК КассыККМ
	               |ГДЕ
	               |	КассыККМ.ПодключаемоеОборудование = &ПодключаемоеОборудование";
	Запрос.УстановитьПараметр("ПодключаемоеОборудование", СсылкаНаПодключаемоеОборудование);
	
	РезультатЗапроса = Запрос.Выполнить();
	Выборка = РезультатЗапроса.Выбрать();
	
	Пока Выборка.Следующий() Цикл
		
		СсылкаКассаККМ = Выборка.Ссылка;
		КассаККМОбъект = СсылкаКассаККМ.ПолучитьОбъект();
		КассаККМОбъект.ПодключаемоеОБорудование = Неопределено;
		КассаККМОбъект.ОфлайнОборудование = СсылкаНаОфлайнОборудование;
		КассаККМОбъект.Записать();
		
	КонецЦикла;
	
	ОбъектОфлайнОборудование = СсылкаНаОфлайнОборудование.ПолучитьОбъект();
	ОбъектОфлайнОборудование.УзелИнформационнойБазы = СсылкаНаПодключаемоеОборудование.УзелИнформационнойБазы;
	ОбъектОфлайнОборудование.ПравилоОбмена = СсылкаНаПодключаемоеОборудование.ПравилоОбмена;
	
	ОбъектОфлайнОборудование.Записать();
	
КонецПроцедуры

// Дополнительные переопределяемые действия для обработки объектов прикладной конфигурации при переходе на новый
// справочник "ОфлайнОборудование".
//
Процедура ДополнительнаяОбработкаОбъектовПриПереходеНаОфлайнОборудование() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	|	ПравилаОбменаСПодключаемымОборудованиемOffline.Ссылка КАК Ссылка,
	|	ПравилаОбменаСПодключаемымОборудованиемOffline.ТипПодключаемогоОборудования КАК ТипПодключаемогоОборудования
	|ИЗ
	|	Справочник.ПравилаОбменаСПодключаемымОборудованиемOffline КАК ПравилаОбменаСПодключаемымОборудованиемOffline";
	
	РезультатЗапроса = Запрос.Выполнить();
	Выборка = РезультатЗапроса.Выбрать();
	
	Пока Выборка.Следующий() Цикл
		
		Если Выборка.ТипПодключаемогоОборудования = ПредопределенноеЗначение("Перечисление.ТипыПодключаемогоОборудования.УдалитьККМОфлайн") Тогда
			СсылкаПравилоОбмена = Выборка.Ссылка;
			ПравилоОбменаОбъект = СсылкаПравилоОбмена.ПолучитьОбъект();
			ПравилоОбменаОбъект.ТипПодключаемогоОборудования = Перечисления.ТипыОфлайнОборудования.ККМ;
			ПравилоОбменаОбъект.Записать();
		КонецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры

#КонецОбласти

#КонецОбласти