////////////////////////////////////////////////////////////////////////////////
// ЕдиныйНалоговыйСчетИнтеграцияФормыКлиент:
//
////////////////////////////////////////////////////////////////////////////////

#Область Авторизация

Процедура АвторизоватьсяНаСервисеEnsIntegration(Оповещение, Форма) Экспорт
	
	ПараметрыПолученияДанных = Новый Структура;
	ПараметрыПолученияДанных.Вставить("Организация",
		Форма.Объект.Организация);
	ПараметрыПолученияДанных.Вставить("ОповещениеПослеАвторизацииНаСервисеEnsIntegration",
		Оповещение);
	ПараметрыПолученияДанных.Вставить("СертификатПодписи",
		Форма.СертификатПодписи);
	ПараметрыПолученияДанных.Вставить("НомерМашиночитаемойДоверенности",
		Форма.НомерМашиночитаемойДоверенности);
	ЕдиныйНалоговыйСчетИнтеграцияКлиент.АвторизоватьсяНаСервисеEnsIntegration(ПараметрыПолученияДанных);
	
КонецПроцедуры

Процедура ПолучитьТокенАвторизацииНаСервисеФНС(Оповещение, Форма, РезультатАвторизацииEnsIntegration, КлючДоступа, ПодписанныйКлюч) Экспорт
	
	ПараметрыПолученияДанных = Новый Структура;
	ПараметрыПолученияДанных.Вставить("Организация",
		Форма.Объект.Организация);
	ПараметрыПолученияДанных.Вставить("ОповещениеПослеВыполненияЗадания",
		Оповещение);
	ПараметрыПолученияДанных.Вставить("РезультатАвторизацииEnsIntegration",
		РезультатАвторизацииEnsIntegration);
	ПараметрыПолученияДанных.Вставить("КлючДоступа",
		КлючДоступа);
	ПараметрыПолученияДанных.Вставить("ПодписанныйКлюч",
		ПодписанныйКлюч);
	ПараметрыПолученияДанных.Вставить("ИспользуетсяДоверенностьНаПолучениеДанных",
		Форма.ИспользуетсяДоверенностьНаПолучениеДанных);
	ПараметрыПолученияДанных.Вставить("НомерМашиночитаемойДоверенности",
		Форма.НомерМашиночитаемойДоверенности);
	ПараметрыПолученияДанных.Вставить("СертификатПодписи",
		Форма.СертификатПодписи);
	ЕдиныйНалоговыйСчетИнтеграцияКлиент.ЗапроситьТокенАвторизацииНаСервисеФНС(ПараметрыПолученияДанных);
	
КонецПроцедуры

Процедура ЗапроситьПодтверждениеРегистрацииEnsIntegration(ОповещениеПослеВыполненияЗадания, Форма, КлючДоступа, ПодписанныйКлюч) Экспорт
	
	ПараметрыПолученияДанных = ПараметрыВыполненияЗапроса(Форма);
	ПараметрыПолученияДанных.Вставить("КлючДоступа",     КлючДоступа);
	ПараметрыПолученияДанных.Вставить("ПодписанныйКлюч", ПодписанныйКлюч);
	ПараметрыПолученияДанных.Вставить("ОповещениеПослеПодтвержденияРегистрацииEnsIntegration", ОповещениеПослеВыполненияЗадания);
	ЕдиныйНалоговыйСчетИнтеграцияКлиент.ЗапроситьПодтверждениеРегистрацииEnsIntegration(ПараметрыПолученияДанных);
	
КонецПроцедуры

#КонецОбласти

#Область ПолучениеДанных

Процедура ОтправитьЗапросНаПолучениеСтатусаЗаданияНаСервисеЕНС(Параметры) Экспорт
	
	ЕдиныйНалоговыйСчетИнтеграцияКлиент.ОтправитьЗапросНаПолучениеСтатусаЗаданияНаСервисеЕНС(Параметры);
	
КонецПроцедуры

Процедура ПолучитьДанныеЕдиногоНалоговогоСчета(ОповещениеПослеВыполненияЗадания, ОповещениеПрерывания, ИмяМетода, Форма) Экспорт
	
	ПараметрыПолученияДанных = ПараметрыВыполненияЗапроса(Форма);
	ПараметрыПолученияДанных.ОписаниеМетода = ЕдиныйНалоговыйСчетИнтеграцияВызовСервера.МетодыAPI(ИмяМетода);
	ПараметрыПолученияДанных.ОповещениеПослеВыполненияЗадания = ОповещениеПослеВыполненияЗадания;
	ПараметрыПолученияДанных.ОповещениеПрерывания             = ОповещениеПрерывания;
	ЕдиныйНалоговыйСчетИнтеграцияКлиент.ПолучитьДанныеЕдиногоНалоговогоСчета(ПараметрыПолученияДанных);
	
КонецПроцедуры

Процедура ЗагрузитьДанныеЕдиногоНалоговогоСчета(Оповещение, ИмяМетода, Форма) Экспорт
	
	ПараметрыПолученияДанных = ПараметрыВыполненияЗапроса(Форма);
	ПараметрыПолученияДанных.ОписаниеМетода = ЕдиныйНалоговыйСчетИнтеграцияВызовСервера.МетодыAPI(ИмяМетода);
	ПараметрыПолученияДанных.ОповещениеПослеВыполненияЗадания = Оповещение;
	ЕдиныйНалоговыйСчетИнтеграцияКлиент.ЗагрузитьДанныеЕдиногоНалоговогоСчета(ПараметрыПолученияДанных);
	
КонецПроцедуры

Процедура ПередОбновлениемДанныхЕдиногоНалоговогоСчета(Форма) Экспорт
	
	Параметры = Новый Структура("Организация", Форма.Объект.Организация);
	
	ЕдиныйНалоговыйСчетИнтеграцияВызовСервера.ПередОбновлениемДанныхЕдиногоНалоговогоСчета(Параметры);
	
КонецПроцедуры

#КонецОбласти

#Область ОбновлениеСправочников

Процедура ПолучитьДанныеСправочников(ОповещениеПослеВыполненияЗадания, ОповещениеПрерывания, ИмяМетода, Форма) Экспорт
	
	ПараметрыПолученияДанных = ПараметрыВыполненияЗапроса(Форма);
	ПараметрыПолученияДанных.ОписаниеМетода = ЕдиныйНалоговыйСчетИнтеграцияВызовСервера.МетодыAPI(ИмяМетода);
	ПараметрыПолученияДанных.ОповещениеПослеВыполненияЗадания = ОповещениеПослеВыполненияЗадания;
	ПараметрыПолученияДанных.ОповещениеПрерывания             = ОповещениеПрерывания;
	ПараметрыПолученияДанных.Вставить("ИспользоватьОтбор", Ложь);
	ЕдиныйНалоговыйСчетИнтеграцияКлиент.ПолучитьДанныеСправочников(ПараметрыПолученияДанных);
	
КонецПроцедуры

Процедура ПолучитьДанныеСправочниковПоОтбору(ОповещениеПослеВыполненияЗадания, ОповещениеПрерывания, ИмяМетода, Форма) Экспорт
	
	ПараметрыПолученияДанных = ПараметрыВыполненияЗапроса(Форма);
	ПараметрыПолученияДанных.ОписаниеМетода = ЕдиныйНалоговыйСчетИнтеграцияВызовСервера.МетодыAPI(ИмяМетода);
	ПараметрыПолученияДанных.ОповещениеПослеВыполненияЗадания = ОповещениеПослеВыполненияЗадания;
	ПараметрыПолученияДанных.ОповещениеПрерывания             = ОповещениеПрерывания;
	ПараметрыПолученияДанных.Вставить("ИспользоватьОтбор", Истина);
	ЕдиныйНалоговыйСчетИнтеграцияКлиент.ПолучитьДанныеСправочников(ПараметрыПолученияДанных);
	
КонецПроцедуры

Процедура ЗагрузитьДанныеСправочников(Оповещение, ИмяМетода, Форма) Экспорт
	
	ПараметрыПолученияДанных = ПараметрыВыполненияЗапроса(Форма);
	ПараметрыПолученияДанных.ОписаниеМетода = ЕдиныйНалоговыйСчетИнтеграцияВызовСервера.МетодыAPI(ИмяМетода);
	ПараметрыПолученияДанных.ОповещениеПослеВыполненияЗадания = Оповещение;
	ЕдиныйНалоговыйСчетИнтеграцияКлиент.ЗагрузитьДанныеЕдиногоНалоговогоСчета(ПараметрыПолученияДанных);
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

Функция ПараметрыВыполненияЗапроса(Форма)
	
	ПараметрыВыполнения = ЕдиныйНалоговыйСчетИнтеграцияКлиентСервер.СтруктураПараметровВыполненияЗапроса();
	
	ПараметрыВыполнения.Вставить("Организация",
		Форма.Объект.Организация);
	ПараметрыВыполнения.Вставить("РезультатАвторизацииEnsIntegration",
		Форма.РезультатАвторизации);
	ПараметрыВыполнения.Вставить("ИспользуетсяДоверенностьНаПолучениеДанных",
		Форма.ИспользуетсяДоверенностьНаПолучениеДанных);
	ПараметрыВыполнения.Вставить("НомерМашиночитаемойДоверенности",
		Форма.НомерМашиночитаемойДоверенности);
	ПараметрыВыполнения.Вставить("ТекущаяДата",
		Форма.Объект.Период);
	ПараметрыВыполнения.Вставить("ДатаПоследнегоОбновления",
		Форма.ДатаПоследнегоОбновления);
	ПараметрыВыполнения.Вставить("СертификатПодписи",
		Форма.СертификатПодписи);
	ПараметрыВыполнения.Вставить("ОповещениеПослеВыполненияЗадания",
		Неопределено);
	ПараметрыВыполнения.Вставить("АдресХранилища",
		Форма.АдресХранилища);
	ПараметрыВыполнения.Вставить("АдресХранилищаДвоичныхДанных",
		Форма.АдресХранилища);
	ПараметрыВыполнения.Вставить("ИспользуетсяАвторизацияСервиса",
		Форма.ИспользуетсяАвторизацияСервиса);
	ПараметрыВыполнения.Вставить("ОповещениеПрерывания",
		Неопределено);
	
	Возврат ПараметрыВыполнения;
	
КонецФункции

#КонецОбласти
